<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.31">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Yekta Amirkhalili">
<meta name="dcterms.date" content="2025-06-22">

<title>Algorithmic Approach to Finding Themes – Yekta’s Dissertation</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-e1a5c8363afafaef2c763b6775fbf3ca.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark-8ef56b68f8fa1e9d2ba328e99e439f80.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-e1a5c8363afafaef2c763b6775fbf3ca.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-02e7b63b13b23c0d612b4df9d70fa878.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark-e1c82c21f31fdb0f854370cce998e929.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="site_libs/bootstrap/bootstrap-02e7b63b13b23c0d612b4df9d70fa878.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css">

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar docked nav-fixed quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Yekta’s Dissertation</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="./index.html" aria-current="page"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./study1.html">Projects</a></li><li class="breadcrumb-item"><a href="./study1.html">Project 1. SLR</a></li><li class="breadcrumb-item"><a href="./study1_theme.html">Algorithmic Approach to Finding Themes</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
        <div class="sidebar-tools-collapse">
    <a href="./github.com/YektaDissertation" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-github"></i></a>
</div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Home</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./basics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Basics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./techAdopt.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Technology Adoption</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./mobileBanking.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mobile Banking</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Projects</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./study1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Project 1. SLR</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./study1_tm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Topic Modeling</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./study1_theme.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Algorithmic Approach to Finding Themes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./study1_DA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data Analysis</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./study2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Project 2. Mental Health</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./study2_DA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Effect Of Mental Health on Mobile Banking</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./study3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Project 3. Digital Divide</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./study3_DA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">study3_DA.html</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar"><div class="quarto-margin-header"><div class="margin-header-item">
<p><img src="./images/uw-logo.png" class="img-fluid"></p>
</div></div>
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#part-0.-jupyter-notebook" id="toc-part-0.-jupyter-notebook" class="nav-link active" data-scroll-target="#part-0.-jupyter-notebook">Part 0. Jupyter Notebook</a></li>
  <li><a href="#part-1.-data-collection" id="toc-part-1.-data-collection" class="nav-link" data-scroll-target="#part-1.-data-collection">Part 1. Data Collection</a>
  <ul class="collapse">
  <li><a href="#part-1.1-finding-out-themes" id="toc-part-1.1-finding-out-themes" class="nav-link" data-scroll-target="#part-1.1-finding-out-themes">Part 1.1 Finding Out Themes</a></li>
  <li><a href="#allowing-for-multiple-themes" id="toc-allowing-for-multiple-themes" class="nav-link" data-scroll-target="#allowing-for-multiple-themes">ALLOWING FOR MULTIPLE THEMES</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">


<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./study1.html">Projects</a></li><li class="breadcrumb-item"><a href="./study1.html">Project 1. SLR</a></li><li class="breadcrumb-item"><a href="./study1_theme.html">Algorithmic Approach to Finding Themes</a></li></ol></nav>
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Algorithmic Approach to Finding Themes</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Yekta Amirkhalili </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">June 22, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<!-- CSS CHANGES -->
<style>
.quarto-title h1.title {
  font-size: 1.5rem; 
}

h2{
    font-size: 1.2rem;
    background-color:rgba(128, 170, 156, 0.48);
}

.future-idea-box {
  border: 2px solid var(--quarto-hl-header-color, #86bdab); /* Uses Quarto header color variable or fallback */
  border-radius: 8px;
  padding: 1em;
  margin: 1em 0;
  background: #f9f9fc;
}
.future-idea-title {
  font-weight: bold;
  color: var(--quarto-hl-header-color,rgb(111, 172, 152));
  margin-bottom: 0.5em;
  font-size: 1.1em;
}

</style>
<!-- CSS CHANGES -->
<section id="part-0.-jupyter-notebook" class="level2">
<h2 class="anchored" data-anchor-id="part-0.-jupyter-notebook">Part 0. Jupyter Notebook</h2>
<p>If you want to run the entire code, use the Jupyter notebook on my github page.</p>
</section>
<section id="part-1.-data-collection" class="level2">
<h2 class="anchored" data-anchor-id="part-1.-data-collection">Part 1. Data Collection</h2>
<p>I downloaded the pdf of all the papers (143), reading them and extracting meta data based on the following:</p>
<div id="53466cac" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np </span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>database <span class="op">=</span> np.array([</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">'id'</span>: <span class="st">'string'</span>, <span class="co"># unique identifier for the paper following convention P2_#number </span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">'title'</span>: <span class="st">'string'</span>, <span class="co"># title of the paper</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">'AffiliationCountry'</span>: <span class="st">'string'</span> , <span class="co">#name of country the study was conducted in,</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">'year'</span>: <span class="dv">2018</span><span class="op">-</span><span class="dv">2024</span>, <span class="co"># year of publication a value between 2018 and 2024</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">'journal'</span>: <span class="st">'string'</span>, <span class="co"># name of the journal the paper was published in</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">'citations'</span>: <span class="dv">0</span><span class="op">-</span><span class="dv">1000</span>, <span class="co"># number of citations the paper has received - not reported in the paper </span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>        <span class="st">'year_since'</span>: <span class="dv">3</span>, <span class="co"># number of years since publication - not reported in the paper </span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>        <span class="st">'cpy'</span>: <span class="dv">0</span>, <span class="co"># number of citations per year - not reported in the paper </span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>        <span class="st">'keywords'</span>: [<span class="st">'TAM'</span>, <span class="st">'mbanking'</span>, <span class="st">'awareness'</span>], <span class="co"># list of keywords, broken into K1-K10</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>        <span class="st">'abstract'</span>: <span class="st">'string'</span>, <span class="co"># abstract of the paper </span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>        <span class="st">'F'</span>: [<span class="st">'perceived usefulness'</span>], <span class="co"># factors significant in the study, broken into F1-F9 </span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>        <span class="st">'FN'</span>: [<span class="st">'another factor'</span>], <span class="co"># factors not significant in the study, broken into FNS1-FNS4 </span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>        <span class="st">'limit'</span>: [<span class="st">'geographical context'</span>], <span class="co"># limitations of the study, broken into LIMIT1-LIMIT3 </span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>        <span class="st">'typeofResearch'</span>: <span class="st">'string'</span>, <span class="co"># type of research conducted in the study </span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>        <span class="st">'methods'</span>: [<span class="st">'regression analysis'</span>], <span class="co"># methods used in the study, broken into METHOD1-METHOD4</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>        <span class="st">'theory'</span>: [<span class="st">'TAM'</span>] <span class="co"># theories used in the study, broken into THEORY1-THEORY4</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>        <span class="st">'sampleSize'</span>: <span class="dv">100</span>, <span class="co"># sample size of the study </span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>        <span class="st">'tech'</span>: <span class="st">'string'</span>, <span class="co"># main technology studied </span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>        <span class="st">'man_theme'</span>: <span class="st">'string'</span>, <span class="co"># Theme manually assigned by me </span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>        <span class="st">'algo_theme'</span>: <span class="st">'string'</span>, <span class="co"># Theme assigned by the algorithm </span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>        <span class="st">'decision_Theme'</span>: <span class="st">'string'</span>, <span class="co"># Final theme of the paper  </span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Score_Sig'</span>: <span class="fl">0.0</span>, <span class="co"># % of significance for factors </span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Score_NOT_Sig'</span>: <span class="fl">0.0</span>, <span class="co"># % of non-significance for factors</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="future-idea-box">
<div class="future-idea-title">
<p>Idea for future</p>
</div>
<p>🤖 Build an Agentic AI application that automates this process.</p>
</div>
<section id="part-1.1-finding-out-themes" class="level3">
<h3 class="anchored" data-anchor-id="part-1.1-finding-out-themes">Part 1.1 Finding Out Themes</h3>
<p>First, install the following Python modules. I saved the pdf files’ name in a dictionary like this:</p>
<div id="c1dfe61f" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>name_of_pdfs <span class="op">=</span> {</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">'p2_01'</span>: <span class="st">"Lonkani et al_2020_A comparative study of trust in mobile banking.pdf"</span>, </span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'p2_02'</span>: <span class="st">"Saprikis et al_2022_A comparative study of users versus non-users' behavioral intention towards.pdf"</span>, </span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'p2_03'</span>: <span class="st">"Malaquias et al_2021_A cross-country study on intention to use mobile banking.pdf"</span>, </span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'p2_04'</span>: <span class="st">"Merhi et al_2019_A cross-cultural study of the intention to use mobile banking between Lebanese.pdf"</span>, </span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'p2_05'</span>: <span class="st">"Frimpong et al. - 2020 - A cross‐national investigation of trait antecedent.pdf"</span>, </span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># and so on ... </span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Additionally, I defined a dictionary “look up” for all the factors in the dataset with their related theme that looks like this (shortened for this presentation):</p>
<div id="c8ebf3ba" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>theme_of_words <span class="op">=</span> {</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">'demographic'</span>: </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>        <span class="bu">list</span>(<span class="bu">set</span>([<span class="st">'women'</span>, <span class="st">'woman'</span>, <span class="st">'female'</span>, <span class="st">'men'</span>, <span class="st">'man'</span>, <span class="st">'male'</span>, <span class="st">'sex'</span>, <span class="st">'gender'</span>, <span class="st">'age'</span>, <span class="st">'income'</span>, </span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>            <span class="st">'demographic variables'</span>, <span class="st">'elderly'</span>, <span class="st">'education'</span>, <span class="st">'gender differences'</span>, <span class="st">'generation y'</span>, <span class="st">'millennial generation'</span>,</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>            <span class="st">'millennial'</span>, <span class="st">'gen y'</span>, <span class="st">'gen Z'</span>, <span class="st">'gen alpha'</span>, <span class="st">'gen X'</span>, <span class="st">'boomer'</span>, <span class="st">'babyboomer'</span>, <span class="st">'generation X'</span>, <span class="st">'generation z'</span>,</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>            <span class="st">'young consumers'</span>, </span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>            <span class="co"># A lot more factors ...</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>            ])),</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">#----------------------------------------------------------------------------------------------------------------------------------</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">'cultural'</span>: </span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>        <span class="bu">list</span>(<span class="bu">set</span>([<span class="st">'developing countries'</span>,<span class="st">'malaysia'</span>,<span class="st">'transition country'</span>,<span class="st">'pakistan'</span>,</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>            <span class="st">'zakat'</span>,<span class="st">'developing country'</span>,<span class="st">'ghana'</span>,<span class="st">'USA'</span>,<span class="st">'srilanka'</span>, <span class="st">'sri lanka'</span>,</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>            <span class="st">'india'</span>,<span class="st">'maldives'</span>,<span class="st">'saudi-arabia'</span>,<span class="st">'saudi arabia'</span>, <span class="st">'nigeria'</span>,<span class="st">'thailand'</span>,<span class="st">'united states'</span>,</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>            <span class="st">'yemen'</span>,<span class="st">'citizenship'</span>,<span class="st">'zimbabwe'</span>,<span class="st">'palestine'</span>,<span class="st">'culture'</span>,</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Country perspective'</span>, </span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>            <span class="co"># ... </span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>            ])),</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>    <span class="co">#----------------------------------------------------------------------------------------------------------------------------------</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">'psychological'</span>:</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>        <span class="bu">list</span>(<span class="bu">set</span>([<span class="st">'anxiety'</span>,<span class="st">'satisfaction'</span>,<span class="st">'behavior'</span>,<span class="st">'behaviour'</span>,<span class="st">'attitudes'</span>,<span class="st">'attitude'</span>,<span class="st">'awareness'</span>,</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>            <span class="st">'technology anxiety'</span>,<span class="st">'consumer-behavior'</span>,<span class="st">'trust'</span>,<span class="st">'benv'</span>,<span class="st">'consumer behaviour'</span>,</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>            <span class="st">'covid-19 related psychological distress'</span>,<span class="st">'psychological distress'</span>,<span class="st">'psychological'</span>,<span class="st">'distress'</span>,</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>            <span class="st">'behavioral'</span>,<span class="st">'computer anxiety'</span>,<span class="st">'customer satisfaction'</span>, <span class="st">'cognitive resistance'</span>,</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>            <span class="co"># A LOT more ... </span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>            ]))</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>            , </span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>            <span class="co"># ... few other key value pairs corresponding to themes </span></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>I also needed to delete some stop words, and decided to add more words that I knew would be frequently repeated. I also define the lemmer and stemmer.</p>
<div id="a16e0e6f" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>stop_words <span class="op">=</span> stopwords.words(<span class="st">'english'</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>stop_words.extend([<span class="st">"bank"</span>, <span class="st">"banking"</span>, <span class="st">"banks"</span>, </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"mobile"</span>, <span class="st">"mbank"</span>, <span class="st">"mbanking"</span>, <span class="st">"m-bank"</span>, <span class="st">"m bank"</span>,</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"online"</span>, <span class="st">"e"</span>, <span class="st">"e-bank"</span>, <span class="st">"ebank"</span>, <span class="st">"mobile banking"</span>, <span class="st">"mobile bank"</span>, </span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"adoption"</span>, <span class="st">"acceptance"</span>, <span class="st">"accept"</span>, <span class="st">"theory"</span>, </span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"purpose"</span>, <span class="st">"result"</span>, <span class="st">"method"</span>, <span class="co">#from abstracts </span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"journal"</span>, <span class="st">"volume"</span>, <span class="st">"pp"</span>, <span class="st">"no"</span>, <span class="st">"doi"</span>, <span class="st">"http"</span>, <span class="st">"https"</span>, <span class="st">"et al"</span>, <span class="st">"issue"</span>,</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"technology"</span>, <span class="st">"internet"</span>, <span class="st">"information system"</span>, <span class="st">"international information"</span>,</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"information technology"</span>, <span class="st">"computer human"</span>, <span class="st">"mis quarterly"</span>, <span class="st">"electornic commerce"</span>,</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"j market"</span>, <span class="st">"telematics and informatics"</span>, <span class="st">"telematics informatics"</span>, <span class="st">"retail consumer"</span>,</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"international volume"</span>, <span class="st">"international business"</span>, <span class="st">"global information"</span>,</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"et"</span>, <span class="st">"al"</span>, <span class="st">"al."</span>, <span class="st">"tam"</span>, <span class="st">"sem"</span>, <span class="st">"pls"</span>, <span class="st">"utaut"</span>, <span class="st">"tpb"</span>,</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>                   <span class="st">".com"</span>, <span class="st">"management"</span>, <span class="st">"marketing"</span>, <span class="st">"published"</span>, <span class="st">"study"</span>,</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"research"</span>, <span class="st">"literature"</span>, <span class="st">"model"</span>, <span class="co">#from journal information </span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"app"</span>, <span class="st">"application"</span>, <span class="st">"usage"</span>])</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>stemmer <span class="op">=</span> PorterStemmer()</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>lemmatizer <span class="op">=</span> WordNetLemmatizer()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="set-up." class="level4">
<h4 class="anchored" data-anchor-id="set-up.">Set up.</h4>
<p>So, I need a few functions as set up for cleaning the text. Function <code>extract_text_from_pdf()</code> is using <code>PyMuPDF</code> to extract text from a PDF file.</p>
<div id="ca540fe0" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">#version one using PyMuPDF </span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> extract_text_from_pdf(filename):</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    text <span class="op">=</span> <span class="st">""</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>        doc <span class="op">=</span> fitz.<span class="bu">open</span>(filename)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> page_num <span class="kw">in</span> <span class="bu">range</span>(doc.page_count):</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>            page <span class="op">=</span> doc.load_page(page_num)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>            text <span class="op">+=</span> page.get_text()</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Error reading </span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> text</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This function is just one of the data cleaning functions: For Topic modeling, I write a function to generate dictionaries and save them in a <code>.mm</code> file format.</p>
<div id="5a069fd6" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> generate_dictionary(text, name):</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">""" </span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co">    As input takes in the text to build the dictionary for and the name of a .mm file</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span> </span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    dictionary <span class="op">=</span> Dictionary(text)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    corpus <span class="op">=</span> [dictionary.doc2bow(review) <span class="cf">for</span> review <span class="kw">in</span> text] </span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    filename <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>name<span class="sc">}</span><span class="ss">.mm"</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    MmCorpus.serialize(filename, corpus)</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> dictionary, corpus</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Additionally, I want a function that prints the top 50 most frequently appearing words in the corpus:</p>
<p>I also plan on seeing how python clusters the words (as in, finds similar words) vs me: This is a function for if you want to use a word embedding (requires some effort, time and machine power!):</p>
<div id="94c71fd5" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_embedding(text):</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    tokenizer <span class="op">=</span> BertTokenizer.from_pretrained(<span class="st">'bert-base-uncased'</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    model_bert <span class="op">=</span> BertModel.from_pretrained(<span class="st">'bert-base-uncased'</span>)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    inputs <span class="op">=</span> tokenizer(text, return_tensors<span class="op">=</span><span class="st">'pt'</span>, truncation<span class="op">=</span><span class="va">True</span>, padding<span class="op">=</span><span class="va">True</span>, max_length<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> torch.no_grad():</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>        outputs <span class="op">=</span> model_bert(<span class="op">**</span>inputs)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> outputs.last_hidden_state.mean(dim<span class="op">=</span><span class="dv">1</span>).squeeze().numpy()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And then you use this to get semantically similar words:</p>
<div id="4cbe9215" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_semantically_similar_words(words, threshold<span class="op">=</span><span class="fl">0.7</span>):</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    similar_words <span class="op">=</span> <span class="bu">set</span>(words)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> word <span class="kw">in</span> words:</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>        token <span class="op">=</span> nlp(word)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> vocab_word <span class="kw">in</span> nlp.vocab:</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> vocab_word.has_vector <span class="kw">and</span> vocab_word.is_alpha:</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>                similarity <span class="op">=</span> token.similarity(nlp(vocab_word.text))</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> similarity <span class="op">&gt;=</span> threshold:</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>                    similar_words.add(vocab_word.text)</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> similar_words</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>So, how do I find the themes? Essentially, I just tweaked TF-IDF:</p>
<div id="ff68eb93" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> CustomTfidfVectorizer(TfidfVectorizer):</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, vocabulary<span class="op">=</span><span class="va">None</span>, <span class="op">**</span>kwargs):</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>        <span class="bu">super</span>().<span class="fu">__init__</span>(vocabulary<span class="op">=</span>vocabulary, <span class="op">**</span>kwargs)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>        <span class="co">#self.general_keywords = set(general_keywords)</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> build_analyzer(<span class="va">self</span>):</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>        analyzer <span class="op">=</span> <span class="bu">super</span>().build_analyzer()</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="kw">lambda</span> doc: [w <span class="cf">for</span> w <span class="kw">in</span> analyzer(doc)] <span class="co">#if w not in self.general_keywords]</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> fit(<span class="va">self</span>, raw_documents, y<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.fit_transform(raw_documents, y)</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> fit_transform(<span class="va">self</span>, raw_documents, y<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>        X <span class="op">=</span> <span class="bu">super</span>().fit_transform(raw_documents, y)</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.max_frequencies <span class="op">=</span> <span class="va">self</span>._compute_max_frequencies(X, raw_documents)</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> X</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> transform(<span class="va">self</span>, raw_documents):</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>        X <span class="op">=</span> <span class="bu">super</span>().transform(raw_documents)</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate augmented term frequency</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>        max_frequencies <span class="op">=</span> <span class="va">self</span>.max_frequencies</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>        max_frequencies[max_frequencies <span class="op">==</span> <span class="dv">0</span>] <span class="op">=</span> <span class="dv">1</span>  <span class="co"># Avoid division by zero</span></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>        augmented_tf <span class="op">=</span> <span class="fl">0.5</span> <span class="op">+</span> <span class="fl">0.5</span> <span class="op">*</span> (X.toarray() <span class="op">/</span> max_frequencies[:, <span class="va">None</span>])</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Penalize general keywords</span></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>        <span class="co">#penalized_idf = self.idf_ * (1 - 0.8 * np.isin(self.get_feature_names_out(), list(self.general_keywords)))</span></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Apply penalized IDF</span></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>        augmented_tfidf <span class="op">=</span> augmented_tf <span class="op">*</span> penalized_idf</span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> csr_matrix(augmented_tfidf)</span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _compute_max_frequencies(<span class="va">self</span>, X, raw_documents):</span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>        max_frequencies <span class="op">=</span> np.zeros(X.shape[<span class="dv">0</span>])</span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i, doc <span class="kw">in</span> <span class="bu">enumerate</span>(raw_documents):</span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>            term_freq <span class="op">=</span> {}</span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> term <span class="kw">in</span> doc.split():</span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> term <span class="kw">in</span> term_freq:</span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a>                    term_freq[term] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a>                    term_freq[term] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a>            max_frequencies[i] <span class="op">=</span> <span class="bu">max</span>(term_freq.values())</span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> max_frequencies</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="keyword-analytics" class="level4">
<h4 class="anchored" data-anchor-id="keyword-analytics">Keyword Analytics</h4>
<div id="181c6e4f" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.read_csv(<span class="st">"P2_AR_04.csv"</span>, encoding<span class="op">=</span><span class="st">'utf-8'</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">UnicodeDecodeError</span>:</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> pd.read_csv(<span class="st">"P2_AR_04.csv"</span>, encoding<span class="op">=</span><span class="st">'latin-1'</span>)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>        error_message <span class="op">=</span> <span class="bu">str</span>(e)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> <span class="va">None</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Clean all the data you’ve gathered the same way the PDF’s have been cleaned (the <code>preprocess_text()</code> function looks very similar to the cleaning function above!):</p>
<div id="36b8e2e3" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>df2 <span class="op">=</span> df.copy()</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>columns_to_preprocess <span class="op">=</span> [<span class="st">'Man_Theme'</span>,</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>                        <span class="st">'K1'</span>,<span class="st">'K2'</span>,<span class="st">'K3'</span>,<span class="st">'K4'</span>,<span class="st">'K5'</span>,<span class="st">'K6'</span>,<span class="st">'K7'</span>,<span class="st">'K8'</span>,<span class="st">'K9'</span>,<span class="st">'K10'</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>                        <span class="st">'F1'</span>,<span class="st">'F2'</span>,<span class="st">'F3'</span>,<span class="st">'F4'</span>,<span class="st">'F5'</span>,<span class="st">'F6'</span>,<span class="st">'F7'</span>,<span class="st">'F8'</span>,<span class="st">'F9'</span>,</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>                        <span class="st">'FNS1'</span>,<span class="st">'FNS2'</span>,<span class="st">'FNS3'</span>,<span class="st">'FNS4'</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>                        <span class="st">'METHOD1'</span>,<span class="st">'METHOD2'</span>,<span class="st">'METHOD3'</span>,<span class="st">'METHOD4'</span>,</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>                        <span class="st">'THEORY1'</span>,<span class="st">'THEORY2'</span>,<span class="st">'THEORY3'</span>,<span class="st">'THEORY4'</span>,</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>                        <span class="st">'LIMIT1'</span> ,<span class="st">'LIMIT2'</span> ,<span class="st">'LIMIT3'</span>, <span class="st">'Abstract'</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>                        ]</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> columns_to_preprocess:</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>    df2[col] <span class="op">=</span> df2[col].<span class="bu">apply</span>(preprocess_text)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="da1b2321" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>papers <span class="op">=</span> {}</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> paper_id, filename <span class="kw">in</span> name_of_pdfs.items():</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    text <span class="op">=</span> extract_text_from_pdf(filename)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    papers[paper_id] <span class="op">=</span> text</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>papers_df <span class="op">=</span> pd.DataFrame.from_dict(papers, orient <span class="op">=</span> <span class="st">'index'</span>, columns <span class="op">=</span> [<span class="st">'paperText'</span>])</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>papers_df <span class="op">=</span> papers_df.reset_index(names <span class="op">=</span> [<span class="st">'paperID'</span>])</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>papers_df.to_csv(<span class="st">'papers_unclean.csv'</span>)</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>papers_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>These look like this: <img src="./images/uncleanData.png" class="img-fluid"></p>
<div id="1064ef50" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># keep a copy (a habit of mine)</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>papers_uncleaned <span class="op">=</span> papers.copy() </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>theme_of_words_uncleaned <span class="op">=</span> theme_of_words.copy() </span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co"># clean up all papers </span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>papers_cleaned <span class="op">=</span> preprocess_Dict(papers)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>papersClean_df <span class="op">=</span> pd.DataFrame.from_dict(papers_cleaned, orient <span class="op">=</span> <span class="st">'index'</span>, columns <span class="op">=</span> [<span class="st">'paperText'</span>])</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>papersClean_df <span class="op">=</span> papersClean_df.reset_index(names <span class="op">=</span> [<span class="st">'paperID'</span>])</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>papersClean_df.to_csv(<span class="st">'papers_clean3.csv'</span>)</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>papersClean_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="./images/cleaned_paper.png" class="img-fluid"></p>
<p>Clean the theme of words dictionary so the words match:</p>
<div id="d90865a8" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>theme_of_words_cleaned <span class="op">=</span> {}</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k, v <span class="kw">in</span> theme_of_words.items():</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    theme_of_words_cleaned[k] <span class="op">=</span> preprocess_list(v)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>theme_of_words_cleaned[<span class="st">'psychological'</span>][:<span class="dv">10</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<blockquote class="blockquote">
<blockquote class="blockquote">
<blockquote class="blockquote">
<p>[‘initial trst’,‘simcong’,‘hedmotiv’,‘selfefficacy’,‘strss’,‘controlled motiv’,‘cong’,‘selfcong cong’,‘trst systems’,‘custom loyalti’]</p>
</blockquote>
</blockquote>
</blockquote>
<p>Make sure to drop all NA’s and empty values:</p>
<div id="ac1785f6" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k, v <span class="kw">in</span> theme_of_words_cleaned.items():</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>    theme_of_words_cleaned[k] <span class="op">=</span> [x <span class="cf">for</span> x <span class="kw">in</span> v <span class="cf">if</span> x <span class="kw">not</span> <span class="kw">in</span> [<span class="va">None</span>, <span class="st">""</span>, <span class="st">' '</span>, <span class="st">'NaN'</span>] <span class="kw">and</span> <span class="kw">not</span> (<span class="bu">isinstance</span>(x, <span class="bu">float</span>) <span class="kw">and</span> math.isnan(x))]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="themes-based-on-count-of-words-in-each-group" class="level4">
<h4 class="anchored" data-anchor-id="themes-based-on-count-of-words-in-each-group">Themes Based on Count of Words in Each Group</h4>
<p>I will skip the parts on BERT and word embeddings that’s in the jupyter notebook as these were not used for my project. The reason is that it was taking so long and my computer simply did not have the capacity to handle it. I also didn’t have the time to find a fix for it, but there are a bunch of commented-out code from chatGPT that I was playing around with.</p>
<p>So, we now have a dictionary with the factors and their theme, and a corpus of text of all papers in the dataset. What I’m going to do here is: * Count all the words <code>total_words</code> in each paper * Count the instances of each word (factor) in <code>theme_of_words_cleaned</code> in each paper * Each word’s count adds 1 point to its corresponding theme’s “weight score” * Take for example the word <strong>emotion</strong> and I said the theme for this word is <strong>psychological</strong>. If emotion shows up 10 times in paper 1, paper 1’s dictionary of weights has a weight of 10 for (divided by the total number of words) psychological.</p>
<div id="04b751ac" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> []</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>count_words_df <span class="op">=</span> pd.DataFrame(results)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> doc_id, text <span class="kw">in</span> papers_cleaned.items():</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    doc <span class="op">=</span> nlp(text)</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    word_counts <span class="op">=</span> defaultdict(<span class="bu">int</span>)</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> token <span class="kw">in</span> doc:</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> group, keywords <span class="kw">in</span> theme_of_words_cleaned.items():</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> token.text.lower() <span class="kw">in</span> keywords:</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>                word_counts[group] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>    total_words <span class="op">=</span> <span class="bu">len</span>(doc)</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>    group_weights <span class="op">=</span> {<span class="ss">f"</span><span class="sc">{</span>group<span class="sc">}</span><span class="ss">_w"</span>: count <span class="op">/</span> total_words <span class="cf">for</span> group, count <span class="kw">in</span> word_counts.items()}</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>    max_weight <span class="op">=</span> <span class="bu">max</span>(group_weights.values(), default<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>    theme <span class="op">=</span> <span class="bu">max</span>(group_weights, key<span class="op">=</span>group_weights.get).replace(<span class="st">"_w"</span>, <span class="st">""</span>) <span class="cf">if</span> max_weight <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="va">None</span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> {<span class="st">"doc_id"</span>: doc_id, <span class="op">**</span>word_counts, <span class="op">**</span>group_weights, <span class="st">"theme"</span>: theme, <span class="st">"max_weight"</span>: max_weight}</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>    results.append(result)</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> group <span class="kw">in</span> theme_of_words_cleaned.keys():</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> group <span class="kw">not</span> <span class="kw">in</span> count_words_df.columns:</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>        count_words_df[group] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="ss">f"</span><span class="sc">{</span>group<span class="sc">}</span><span class="ss">_w"</span> <span class="kw">not</span> <span class="kw">in</span> count_words_df.columns:</span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>        count_words_df[<span class="ss">f"</span><span class="sc">{</span>group<span class="sc">}</span><span class="ss">_w"</span>] <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>count_words_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="./images/count_words_df.png" class="img-fluid"></p>
<p>This is still very basic, though because it’s only based on the factors which may not be fully representative. So, I do this again using keywords in addition to the factors. These are keywords that were selected by the authors as well as information extracted from Web of Science <span class="math inline">\BibTeX</span> file.</p>
<div id="514ef7c7" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>cols_toPick <span class="op">=</span> [<span class="st">'K1'</span>,<span class="st">'K2'</span>,<span class="st">'K3'</span>,<span class="st">'K4'</span>,<span class="st">'K5'</span>,<span class="st">'K6'</span>,<span class="st">'K7'</span>,<span class="st">'K8'</span>,<span class="st">'K9'</span>,<span class="st">'K10'</span>,<span class="st">'F1'</span>,<span class="st">'F2'</span>,<span class="st">'F3'</span>,<span class="st">'F4'</span>,<span class="st">'F5'</span>,<span class="st">'F6'</span>,<span class="st">'F7'</span>,<span class="st">'F8'</span>,<span class="st">'F9'</span>]</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>keywordsDf <span class="op">=</span> df2.loc[:,cols_toPick]</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="co"># flatten the dataframe to a list </span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>keywords_across_db <span class="op">=</span> keywordsDf.values.flatten().tolist()</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="co"># there are 2,717 words here </span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"number of words (factors and keywords) in total "</span>, <span class="bu">len</span>(keywords_across_db))</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="co"># making sure there are no empty/NaN/Null values </span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>keywords_across_db <span class="op">=</span> [x <span class="cf">for</span> x <span class="kw">in</span> keywords_across_db <span class="cf">if</span> x <span class="kw">not</span> <span class="kw">in</span> [<span class="va">None</span>, <span class="st">""</span>, <span class="st">' '</span>, <span class="st">'NaN'</span>] <span class="kw">and</span> <span class="kw">not</span> (<span class="bu">isinstance</span>(x, <span class="bu">float</span>) <span class="kw">and</span> math.isnan(x))]</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a><span class="co"># making sure there are no duplicates (set takes care of this)</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>keywords_across_db_nodup_cleaned <span class="op">=</span> <span class="bu">list</span>(<span class="bu">set</span>(keywords_across_db))</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a><span class="co"># convert the list into a dictionary temporarily, then convert it to a dataframe </span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>temp <span class="op">=</span> {<span class="st">'Keyword'</span>: keywords_across_db_nodup_cleaned}</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>keywords_themes_df <span class="op">=</span> pd.DataFrame(temp, columns<span class="op">=</span>[<span class="st">'Keyword'</span>])</span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a><span class="co"># go back to the theme_of_words_cleaned and find each keyword's theme </span></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>keywords_themes_dic <span class="op">=</span> {keyword: theme <span class="cf">for</span> theme, keywords <span class="kw">in</span> theme_of_words_cleaned.items() <span class="cf">for</span> keyword <span class="kw">in</span> keywords}</span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a><span class="co"># This is just a dataframe view of the keywords with their respective theme </span></span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>keywords_themes_df[<span class="st">'Theme'</span>] <span class="op">=</span> keywords_themes_df[<span class="st">'Keyword'</span>].<span class="bu">map</span>(keywords_themes_dic)</span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a><span class="co"># if the theme is empty, give it "Generic" - that means these keywords weren't in the list of important words that we picked themes for </span></span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>keywords_themes_df[<span class="st">'Theme'</span>] <span class="op">=</span> keywords_themes_df[<span class="st">'Theme'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="st">'Generic'</span> <span class="cf">if</span> pd.isna(x) <span class="kw">or</span> x <span class="op">==</span> <span class="st">' '</span> <span class="cf">else</span> x)</span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a>keywords_themes_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="./images/keywordtheme.png" class="img-fluid"></p>
<p>I’m gonna get rid of all the Generic keywords, so keeping a copy of this dataframe:</p>
<div id="e779e2b5" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>keywords_themes_df_withGenerics <span class="op">=</span> keywords_themes_df.copy()</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>keywords_themes_df[<span class="st">'Theme'</span>] <span class="op">=</span> keywords_themes_df[<span class="st">'Theme'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="st">'Generic'</span> <span class="cf">if</span> pd.isna(x) <span class="kw">or</span> x <span class="op">==</span> <span class="st">' '</span> <span class="cf">else</span> x)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="co"># everything but generic </span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>keywords_themes_df <span class="op">=</span> keywords_themes_df.loc[keywords_themes_df[<span class="st">'Theme'</span>] <span class="op">!=</span> <span class="st">'Generic'</span>]</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="co"># flatten it to build a vocabulary </span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>words_acrossAll_nonGeneric <span class="op">=</span> keywords_themes_df[<span class="st">'Keyword'</span>].values.flatten().tolist()</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a><span class="co"># making sure no null values were generated </span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>words_acrossAll_nonGeneric <span class="op">=</span> [x <span class="cf">for</span> x <span class="kw">in</span> words_acrossAll_nonGeneric <span class="cf">if</span> x <span class="kw">not</span> <span class="kw">in</span> [<span class="va">None</span>, <span class="st">""</span>, <span class="st">' '</span>, <span class="st">'NaN'</span>] <span class="kw">and</span> <span class="kw">not</span> (<span class="bu">isinstance</span>(x, <span class="bu">float</span>) <span class="kw">and</span> math.isnan(x))]</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a><span class="co"># making sure there are no dulicates (233 words total)</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>words_acrossAll_nonGeneric <span class="op">=</span> <span class="bu">list</span>(<span class="bu">set</span>(words_acrossAll_nonGeneric))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="theme-assignment" class="level4">
<h4 class="anchored" data-anchor-id="theme-assignment">Theme Assignment</h4>
<p>I will now use the custom TF-IDF class to generate a TF-IDF matrix. This is similar to what I did by hand a bit further above. Basically, all TF-IDF is doing is counting the frequency of words across the document.</p>
<div id="90e17eea" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>vectorizer_keys <span class="op">=</span> CustomTfidfVectorizer(vocabulary <span class="op">=</span> words_acrossAll_nonGeneric)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>tfidf_matrix <span class="op">=</span> vectorizer_keys.fit_transform(papers_cleaned.values())</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>tfidf_df <span class="op">=</span> pd.DataFrame(tfidf_matrix.toarray(), index <span class="op">=</span> papers_cleaned.keys(), columns<span class="op">=</span>vectorizer_keys.get_feature_names_out())</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>tfidf_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="./images/tfidf_head1.png" class="img-fluid"></p>
<p>Now using TF-IDF scores, finding the weights for themes for each paper:</p>
<div id="b3c3b106" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>keyword_to_theme <span class="op">=</span> {keyword: theme <span class="cf">for</span> theme, keywords <span class="kw">in</span> theme_of_words_cleaned.items() <span class="cf">for</span> keyword <span class="kw">in</span> keywords}</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>theme_weights <span class="op">=</span> pd.DataFrame(<span class="dv">0</span>, index<span class="op">=</span>tfidf_df.index, columns<span class="op">=</span>theme_of_words_cleaned.keys())</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> keyword, theme <span class="kw">in</span> keyword_to_theme.items():</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> keyword <span class="kw">in</span> tfidf_df.columns:</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>        theme_weights[theme] <span class="op">+=</span> tfidf_df[keyword]</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> _, row <span class="kw">in</span> df2.iterrows():</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>    paper_id <span class="op">=</span> row[<span class="st">'ID'</span>]</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>    keywords <span class="op">=</span> words_acrossAll_nonGeneric </span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> keyword <span class="kw">in</span> keywords:</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> keyword <span class="kw">in</span> tfidf_df.columns:</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>            theme <span class="op">=</span> keyword_to_theme.get(keyword, <span class="va">None</span>)</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> theme:</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>                <span class="co">#if theme in tfidf_df.index:</span></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>                theme_weights.at[paper_id, theme] <span class="op">+=</span> tfidf_df.at[paper_id, keyword] <span class="op">*</span> <span class="dv">5</span>  </span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a><span class="co"># this is picking just 1 theme per paper - find the theme with the maximum weight as the main theme of the paper </span></span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>main_theme_df <span class="op">=</span> theme_weights.<span class="bu">apply</span>(<span class="kw">lambda</span> row: (row <span class="op">==</span> row.<span class="bu">max</span>()).astype(<span class="bu">int</span>), axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>main_theme_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="./images/theme_pick1.png" class="img-fluid"></p>
<p>Visualizing this:</p>
<div id="7f097b41" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(nrows<span class="op">=</span><span class="dv">2</span>, ncols<span class="op">=</span><span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">20</span>, <span class="dv">10</span>))</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Heatmap for theme weights</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>sns.heatmap(theme_weights.T, ax<span class="op">=</span>axes[<span class="dv">0</span>], cmap<span class="op">=</span><span class="st">"YlGnBu_r"</span>, cbar_kws<span class="op">=</span>{<span class="st">'label'</span>: <span class="st">'Weight'</span>})</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_xlabel(<span class="st">"Paper ID"</span>)</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_ylabel(<span class="st">"Theme"</span>)</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_title(<span class="st">"Theme Weights per Paper"</span>)</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Heatmap for main themes</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>sns.heatmap(main_theme_df.T, ax<span class="op">=</span>axes[<span class="dv">1</span>], cmap<span class="op">=</span><span class="st">"YlGnBu_r"</span>, cbar_kws<span class="op">=</span>{<span class="st">'label'</span>: <span class="st">'Theme Presence'</span>})</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_xlabel(<span class="st">"Paper ID"</span>)</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_ylabel(<span class="st">"Theme"</span>)</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_title(<span class="st">"Main Theme per Paper"</span>)</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">'main_themes_heatmap_1.png'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="./images/main_themes_heatmap_1.png" class="img-fluid"></p>
<p>To extract the themes easily:</p>
<div id="fb81e7fe" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract themes for each paper</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>themes_for_papers <span class="op">=</span> {</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    paper_id: main_theme_df.columns[row.astype(<span class="bu">bool</span>)].tolist()</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> paper_id, row <span class="kw">in</span> main_theme_df.iterrows()</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the themes for each paper</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> paper_id, themes <span class="kw">in</span> themes_for_papers.items():</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Paper ID: </span><span class="sc">{</span>paper_id<span class="sc">}</span><span class="ss">, Themes: </span><span class="sc">{</span><span class="st">', '</span><span class="sc">.</span>join(themes)<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<blockquote class="blockquote">
<p>Paper ID: p2_01, Themes: psychological Paper ID: p2_02, Themes: psychological Paper ID: p2_03, Themes: psychological Paper ID: p2_04, Themes: psychological Paper ID: p2_05, Themes: psychological Paper ID: p2_06, Themes: perceptive Paper ID: p2_07, Themes: personal Paper ID: p2_08, Themes: personal Paper ID: p2_09, Themes: perceptive Paper ID: p2_10, Themes: psychological</p>
</blockquote>
<p>Since Topic Modeling is Multimembership, papers can have more than just 1 theme. Since I didn’t use a word embedding and may not get the best representatitve theme here, I decided to allow for up to 3 themes. To do this, I changed the <code>CustomTfidfVectorizer</code> class.</p>
</section>
</section>
<section id="allowing-for-multiple-themes" class="level3">
<h3 class="anchored" data-anchor-id="allowing-for-multiple-themes">ALLOWING FOR MULTIPLE THEMES</h3>
<div id="d63ecf58" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> CustomTfidfVectorizerUpdateClass(TfidfVectorizer):</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, theme_keywords, threshold<span class="op">=</span><span class="fl">0.8</span>, <span class="op">**</span>kwargs):</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Generate vocabulary from theme_keywords</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>        vocabulary <span class="op">=</span> <span class="bu">list</span>(<span class="bu">set</span>(word <span class="cf">for</span> words <span class="kw">in</span> theme_keywords.values() <span class="cf">for</span> word <span class="kw">in</span> words))</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>        <span class="bu">super</span>().<span class="fu">__init__</span>(vocabulary<span class="op">=</span>vocabulary, <span class="op">**</span>kwargs)</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.threshold <span class="op">=</span> threshold  <span class="co"># Threshold for determining multiple themes</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.theme_keywords <span class="op">=</span> theme_keywords  <span class="co"># Store theme_keywords for later use</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> build_analyzer(<span class="va">self</span>):</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>        analyzer <span class="op">=</span> <span class="bu">super</span>().build_analyzer()</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="kw">lambda</span> doc: [w <span class="cf">for</span> w <span class="kw">in</span> analyzer(doc)]</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> fit(<span class="va">self</span>, raw_documents, y<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.fit_transform(raw_documents, y)</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> fit_transform(<span class="va">self</span>, raw_documents, y<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>        X <span class="op">=</span> <span class="bu">super</span>().fit_transform(raw_documents, y)</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.max_frequencies <span class="op">=</span> <span class="va">self</span>._compute_max_frequencies(X, raw_documents)</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> X</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> transform(<span class="va">self</span>, raw_documents):</span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>        X <span class="op">=</span> <span class="bu">super</span>().transform(raw_documents)</span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate augmented term frequency</span></span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>        max_frequencies <span class="op">=</span> <span class="va">self</span>.max_frequencies</span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>        max_frequencies[max_frequencies <span class="op">==</span> <span class="dv">0</span>] <span class="op">=</span> <span class="dv">1</span>  <span class="co"># Avoid division by zero</span></span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a>        augmented_tf <span class="op">=</span> <span class="fl">0.5</span> <span class="op">+</span> <span class="fl">0.5</span> <span class="op">*</span> (X.toarray() <span class="op">/</span> max_frequencies[:, <span class="va">None</span>])</span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a>        augmented_tfidf <span class="op">=</span> augmented_tf  <span class="co"># No penalized IDF applied here</span></span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> csr_matrix(augmented_tfidf)</span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> determine_themes(<span class="va">self</span>, documents_dict):</span>
<span id="cb23-35"><a href="#cb23-35" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb23-36"><a href="#cb23-36" aria-hidden="true" tabindex="-1"></a><span class="co">        Determines the themes for each document based on TF-IDF scores.</span></span>
<span id="cb23-37"><a href="#cb23-37" aria-hidden="true" tabindex="-1"></a><span class="co">        A paper can have multiple themes if the scores are within the threshold.</span></span>
<span id="cb23-38"><a href="#cb23-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-39"><a href="#cb23-39" aria-hidden="true" tabindex="-1"></a><span class="co">        :param documents_dict: Dictionary of documents (keys: IDs, values: text)</span></span>
<span id="cb23-40"><a href="#cb23-40" aria-hidden="true" tabindex="-1"></a><span class="co">        :return: Dictionary where keys are document IDs and values are lists of themes</span></span>
<span id="cb23-41"><a href="#cb23-41" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb23-42"><a href="#cb23-42" aria-hidden="true" tabindex="-1"></a>        document_ids <span class="op">=</span> <span class="bu">list</span>(documents_dict.keys())</span>
<span id="cb23-43"><a href="#cb23-43" aria-hidden="true" tabindex="-1"></a>        raw_documents <span class="op">=</span> <span class="bu">list</span>(documents_dict.values())</span>
<span id="cb23-44"><a href="#cb23-44" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb23-45"><a href="#cb23-45" aria-hidden="true" tabindex="-1"></a>        X <span class="op">=</span> <span class="va">self</span>.transform(raw_documents).toarray()</span>
<span id="cb23-46"><a href="#cb23-46" aria-hidden="true" tabindex="-1"></a>        feature_name_to_index <span class="op">=</span> {name: i <span class="cf">for</span> i, name <span class="kw">in</span> <span class="bu">enumerate</span>(<span class="va">self</span>.get_feature_names_out())}</span>
<span id="cb23-47"><a href="#cb23-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-48"><a href="#cb23-48" aria-hidden="true" tabindex="-1"></a>        theme_scores <span class="op">=</span> {}</span>
<span id="cb23-49"><a href="#cb23-49" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> doc_index, doc_vector <span class="kw">in</span> <span class="bu">enumerate</span>(X):</span>
<span id="cb23-50"><a href="#cb23-50" aria-hidden="true" tabindex="-1"></a>            doc_id <span class="op">=</span> document_ids[doc_index]</span>
<span id="cb23-51"><a href="#cb23-51" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Calculate scores for each theme</span></span>
<span id="cb23-52"><a href="#cb23-52" aria-hidden="true" tabindex="-1"></a>            scores <span class="op">=</span> {</span>
<span id="cb23-53"><a href="#cb23-53" aria-hidden="true" tabindex="-1"></a>                theme: <span class="bu">sum</span>(doc_vector[feature_name_to_index[word]]</span>
<span id="cb23-54"><a href="#cb23-54" aria-hidden="true" tabindex="-1"></a>                           <span class="cf">for</span> word <span class="kw">in</span> keywords <span class="cf">if</span> word <span class="kw">in</span> feature_name_to_index)</span>
<span id="cb23-55"><a href="#cb23-55" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> theme, keywords <span class="kw">in</span> <span class="va">self</span>.theme_keywords.items()</span>
<span id="cb23-56"><a href="#cb23-56" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb23-57"><a href="#cb23-57" aria-hidden="true" tabindex="-1"></a>            max_score <span class="op">=</span> <span class="bu">max</span>(scores.values()) <span class="cf">if</span> scores <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb23-58"><a href="#cb23-58" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb23-59"><a href="#cb23-59" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Determine themes within the threshold</span></span>
<span id="cb23-60"><a href="#cb23-60" aria-hidden="true" tabindex="-1"></a>            selected_themes <span class="op">=</span> [</span>
<span id="cb23-61"><a href="#cb23-61" aria-hidden="true" tabindex="-1"></a>                theme <span class="cf">for</span> theme, score <span class="kw">in</span> scores.items()</span>
<span id="cb23-62"><a href="#cb23-62" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> score <span class="op">&gt;=</span> <span class="va">self</span>.threshold <span class="op">*</span> max_score</span>
<span id="cb23-63"><a href="#cb23-63" aria-hidden="true" tabindex="-1"></a>            ]</span>
<span id="cb23-64"><a href="#cb23-64" aria-hidden="true" tabindex="-1"></a>            theme_scores[doc_id] <span class="op">=</span> selected_themes</span>
<span id="cb23-65"><a href="#cb23-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-66"><a href="#cb23-66" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> theme_scores</span>
<span id="cb23-67"><a href="#cb23-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-68"><a href="#cb23-68" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _compute_max_frequencies(<span class="va">self</span>, X, raw_documents):</span>
<span id="cb23-69"><a href="#cb23-69" aria-hidden="true" tabindex="-1"></a>        max_frequencies <span class="op">=</span> np.zeros(X.shape[<span class="dv">0</span>])</span>
<span id="cb23-70"><a href="#cb23-70" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i, doc <span class="kw">in</span> <span class="bu">enumerate</span>(raw_documents):</span>
<span id="cb23-71"><a href="#cb23-71" aria-hidden="true" tabindex="-1"></a>            term_freq <span class="op">=</span> {}</span>
<span id="cb23-72"><a href="#cb23-72" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> term <span class="kw">in</span> doc.split():</span>
<span id="cb23-73"><a href="#cb23-73" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> term <span class="kw">in</span> term_freq:</span>
<span id="cb23-74"><a href="#cb23-74" aria-hidden="true" tabindex="-1"></a>                    term_freq[term] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb23-75"><a href="#cb23-75" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb23-76"><a href="#cb23-76" aria-hidden="true" tabindex="-1"></a>                    term_freq[term] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb23-77"><a href="#cb23-77" aria-hidden="true" tabindex="-1"></a>            max_frequencies[i] <span class="op">=</span> <span class="bu">max</span>(term_freq.values())</span>
<span id="cb23-78"><a href="#cb23-78" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> max_frequencies</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Similar to the above task, I generate the vectorizer from <code>theme_of_words_cleaned</code> vocabulary, but this time, allow for a few more themes (<code>threshold = 0.75</code>).</p>
<div id="b701c757" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>vectorizer_keys2 <span class="op">=</span> CustomTfidfVectorizerUpdateClass(theme_keywords <span class="op">=</span> theme_of_words_cleaned, threshold <span class="op">=</span> <span class="fl">0.75</span>) </span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>tfidf_matrix2 <span class="op">=</span> vectorizer_keys2.fit_transform(papers_cleaned.values())</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>tfidf_df2 <span class="op">=</span> pd.DataFrame(tfidf_matrix2.toarray(), index<span class="op">=</span>papers_cleaned.keys(), columns<span class="op">=</span>vectorizer_keys2.get_feature_names_out())</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>tfidf_df2.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="./images/tfidf_2.png" class="img-fluid"></p>
<p>You can still pick a main theme for each paper, but I want to see the top 3 themes:</p>
<div id="6053eb7e" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>keyword_to_theme2 <span class="op">=</span> {keyword: theme <span class="cf">for</span> theme, keywords <span class="kw">in</span> theme_of_words_cleaned.items() <span class="cf">for</span> keyword <span class="kw">in</span> keywords}</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>theme_weights2 <span class="op">=</span> pd.DataFrame(<span class="dv">0</span>, index<span class="op">=</span>tfidf_df2.index, columns<span class="op">=</span>theme_of_words_cleaned.keys())</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> keyword, theme <span class="kw">in</span> keyword_to_theme2.items():</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> keyword <span class="kw">in</span> tfidf_df2.columns:</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>        theme_weights2[theme] <span class="op">+=</span> tfidf_df2[keyword]</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> _, row <span class="kw">in</span> df2.iterrows():</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>    paper_id <span class="op">=</span> row[<span class="st">'ID'</span>]</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">#for keyword in words_acrossAll_nonGeneric:</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> keyword <span class="kw">in</span> vectorizer_keys2.get_feature_names_out():</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> keyword <span class="kw">in</span> tfidf_df2.columns:</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>            theme <span class="op">=</span> keyword_to_theme2.get(keyword, <span class="va">None</span>)</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> theme:</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>                <span class="co"># the 5 I'm adding here is just to make the weights a bit larger for visualization. It's a simple scaling and won't change the results </span></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>                theme_weights2.at[paper_id, theme] <span class="op">+=</span> tfidf_df2.at[paper_id, keyword] <span class="op">*</span> <span class="dv">5</span></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>top_3_themes_for_papers <span class="op">=</span> {</span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>    paper_id: theme_weights2.loc[paper_id]</span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>    .sort_values(ascending<span class="op">=</span><span class="va">False</span>)[:<span class="dv">3</span>]  </span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>    .index.tolist()</span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> paper_id <span class="kw">in</span> theme_weights2.index</span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> paper_id, themes <span class="kw">in</span> top_3_themes_for_papers.items():</span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Paper ID: </span><span class="sc">{</span>paper_id<span class="sc">}</span><span class="ss">, Top 3 Themes: </span><span class="sc">{</span><span class="st">', '</span><span class="sc">.</span>join(themes)<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<blockquote class="blockquote">
<p>Paper ID: p2_01, Top 3 Themes: psychological, cultural, demographic Paper ID: p2_02, Top 3 Themes: psychological, market, personal Paper ID: p2_03, Top 3 Themes: psychological, personal, perceptive Paper ID: p2_04, Top 3 Themes: psychological, personal, perceptive Paper ID: p2_05, Top 3 Themes: cultural, personal, psychological Paper ID: p2_06, Top 3 Themes: perceptive, cultural, psychological Paper ID: p2_07, Top 3 Themes: personal, psychological, demographic Paper ID: p2_08, Top 3 Themes: psychological, personal, perceptive Paper ID: p2_09, Top 3 Themes: perceptive, psychological, personal Paper ID: p2_10, Top 3 Themes: psychological, cultural, personal</p>
</blockquote>
<p>Keep a copy and save this to file:</p>
<div id="3c3605e4" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>df3 <span class="op">=</span> df2.copy()</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>top_3_themes_for_papers <span class="op">=</span> {</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>    paper_id: <span class="st">", "</span>.join(theme_weights2.loc[paper_id]</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>                         .sort_values(ascending<span class="op">=</span><span class="va">False</span>)[:<span class="dv">3</span>]</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>                         .index.tolist())</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> paper_id <span class="kw">in</span> theme_weights2.index</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>df3[<span class="st">"Algo_Theme"</span>] <span class="op">=</span> df2[<span class="st">"ID"</span>].<span class="bu">map</span>(top_3_themes_for_papers)</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>df3.to_csv(<span class="st">"NewWithThemes.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


<!-- -->

</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb27" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Algorithmic Approach to Finding Themes" </span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "Yekta Amirkhalili"</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "today"</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span><span class="co"> </span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="co">  html: </span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: false</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="co">    self-contained: false</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a><span class="co">    execute:</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a><span class="co">      eval: false </span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a><span class="co">      echo: true</span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a><span class="co">      warning: false</span></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a><span class="co">      message: false</span></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a><span class="co">      error: false</span></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a><span class="co">      results: 'asis'</span></span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a><span class="co">    #css: style.css</span></span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- CSS CHANGES --&gt;</span></span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">style</span><span class="dt">&gt;</span></span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a><span class="fu">.quarto-title</span> h1<span class="fu">.title</span> {</span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>  <span class="kw">font-size</span><span class="ch">:</span> <span class="dv">1.5</span><span class="dt">rem</span><span class="op">;</span> </span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a>h2{</span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a>    <span class="kw">font-size</span><span class="ch">:</span> <span class="dv">1.2</span><span class="dt">rem</span><span class="op">;</span></span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a>    <span class="kw">background-color</span><span class="ch">:</span><span class="fu">rgba(</span><span class="dv">128</span><span class="op">,</span> <span class="dv">170</span><span class="op">,</span> <span class="dv">156</span><span class="op">,</span> <span class="dv">0.48</span><span class="fu">)</span><span class="op">;</span></span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-29"><a href="#cb27-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-30"><a href="#cb27-30" aria-hidden="true" tabindex="-1"></a><span class="fu">.future-idea-box</span> {</span>
<span id="cb27-31"><a href="#cb27-31" aria-hidden="true" tabindex="-1"></a>  <span class="kw">border</span><span class="ch">:</span> <span class="dv">2</span><span class="dt">px</span> <span class="dv">solid</span> <span class="fu">var(</span><span class="va">--quarto-hl-header-color</span><span class="op">,</span> <span class="cn">#86bdab</span><span class="fu">)</span><span class="op">;</span> <span class="co">/* Uses Quarto header color variable or fallback */</span></span>
<span id="cb27-32"><a href="#cb27-32" aria-hidden="true" tabindex="-1"></a>  <span class="kw">border-radius</span><span class="ch">:</span> <span class="dv">8</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb27-33"><a href="#cb27-33" aria-hidden="true" tabindex="-1"></a>  <span class="kw">padding</span><span class="ch">:</span> <span class="dv">1</span><span class="dt">em</span><span class="op">;</span></span>
<span id="cb27-34"><a href="#cb27-34" aria-hidden="true" tabindex="-1"></a>  <span class="kw">margin</span><span class="ch">:</span> <span class="dv">1</span><span class="dt">em</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb27-35"><a href="#cb27-35" aria-hidden="true" tabindex="-1"></a>  <span class="kw">background</span><span class="ch">:</span> <span class="cn">#f9f9fc</span><span class="op">;</span></span>
<span id="cb27-36"><a href="#cb27-36" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-37"><a href="#cb27-37" aria-hidden="true" tabindex="-1"></a><span class="fu">.future-idea-title</span> {</span>
<span id="cb27-38"><a href="#cb27-38" aria-hidden="true" tabindex="-1"></a>  <span class="kw">font-weight</span><span class="ch">:</span> <span class="dv">bold</span><span class="op">;</span></span>
<span id="cb27-39"><a href="#cb27-39" aria-hidden="true" tabindex="-1"></a>  <span class="kw">color</span><span class="ch">:</span> <span class="fu">var(</span><span class="va">--quarto-hl-header-color</span><span class="op">,</span><span class="fu">rgb(</span><span class="dv">111</span><span class="op">,</span> <span class="dv">172</span><span class="op">,</span> <span class="dv">152</span><span class="fu">))</span><span class="op">;</span></span>
<span id="cb27-40"><a href="#cb27-40" aria-hidden="true" tabindex="-1"></a>  <span class="kw">margin-bottom</span><span class="ch">:</span> <span class="dv">0.5</span><span class="dt">em</span><span class="op">;</span></span>
<span id="cb27-41"><a href="#cb27-41" aria-hidden="true" tabindex="-1"></a>  <span class="kw">font-size</span><span class="ch">:</span> <span class="dv">1.1</span><span class="dt">em</span><span class="op">;</span></span>
<span id="cb27-42"><a href="#cb27-42" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-43"><a href="#cb27-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-44"><a href="#cb27-44" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">style</span><span class="dt">&gt;</span></span>
<span id="cb27-45"><a href="#cb27-45" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- CSS CHANGES --&gt;</span></span>
<span id="cb27-46"><a href="#cb27-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-47"><a href="#cb27-47" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 0. Jupyter Notebook </span></span>
<span id="cb27-48"><a href="#cb27-48" aria-hidden="true" tabindex="-1"></a>If you want to run the entire code, use the Jupyter notebook on my github page. </span>
<span id="cb27-49"><a href="#cb27-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-50"><a href="#cb27-50" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 1. Data Collection</span></span>
<span id="cb27-51"><a href="#cb27-51" aria-hidden="true" tabindex="-1"></a>I downloaded the pdf of all the papers (143), reading them and extracting meta data based on the following:</span>
<span id="cb27-52"><a href="#cb27-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-53"><a href="#cb27-53" aria-hidden="true" tabindex="-1"></a><span class="in">```{python chunk_theme_1 name="meta_data_extraction"}</span></span>
<span id="cb27-54"><a href="#cb27-54" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false </span></span>
<span id="cb27-55"><a href="#cb27-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-56"><a href="#cb27-56" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np </span>
<span id="cb27-57"><a href="#cb27-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-58"><a href="#cb27-58" aria-hidden="true" tabindex="-1"></a>database <span class="op">=</span> np.array([</span>
<span id="cb27-59"><a href="#cb27-59" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb27-60"><a href="#cb27-60" aria-hidden="true" tabindex="-1"></a>        <span class="st">'id'</span>: <span class="st">'string'</span>, <span class="co"># unique identifier for the paper following convention P2_#number </span></span>
<span id="cb27-61"><a href="#cb27-61" aria-hidden="true" tabindex="-1"></a>        <span class="st">'title'</span>: <span class="st">'string'</span>, <span class="co"># title of the paper</span></span>
<span id="cb27-62"><a href="#cb27-62" aria-hidden="true" tabindex="-1"></a>        <span class="st">'AffiliationCountry'</span>: <span class="st">'string'</span> , <span class="co">#name of country the study was conducted in,</span></span>
<span id="cb27-63"><a href="#cb27-63" aria-hidden="true" tabindex="-1"></a>        <span class="st">'year'</span>: <span class="dv">2018</span><span class="op">-</span><span class="dv">2024</span>, <span class="co"># year of publication a value between 2018 and 2024</span></span>
<span id="cb27-64"><a href="#cb27-64" aria-hidden="true" tabindex="-1"></a>        <span class="st">'journal'</span>: <span class="st">'string'</span>, <span class="co"># name of the journal the paper was published in</span></span>
<span id="cb27-65"><a href="#cb27-65" aria-hidden="true" tabindex="-1"></a>        <span class="st">'citations'</span>: <span class="dv">0</span><span class="op">-</span><span class="dv">1000</span>, <span class="co"># number of citations the paper has received - not reported in the paper </span></span>
<span id="cb27-66"><a href="#cb27-66" aria-hidden="true" tabindex="-1"></a>        <span class="st">'year_since'</span>: <span class="dv">3</span>, <span class="co"># number of years since publication - not reported in the paper </span></span>
<span id="cb27-67"><a href="#cb27-67" aria-hidden="true" tabindex="-1"></a>        <span class="st">'cpy'</span>: <span class="dv">0</span>, <span class="co"># number of citations per year - not reported in the paper </span></span>
<span id="cb27-68"><a href="#cb27-68" aria-hidden="true" tabindex="-1"></a>        <span class="st">'keywords'</span>: [<span class="st">'TAM'</span>, <span class="st">'mbanking'</span>, <span class="st">'awareness'</span>], <span class="co"># list of keywords, broken into K1-K10</span></span>
<span id="cb27-69"><a href="#cb27-69" aria-hidden="true" tabindex="-1"></a>        <span class="st">'abstract'</span>: <span class="st">'string'</span>, <span class="co"># abstract of the paper </span></span>
<span id="cb27-70"><a href="#cb27-70" aria-hidden="true" tabindex="-1"></a>        <span class="st">'F'</span>: [<span class="st">'perceived usefulness'</span>], <span class="co"># factors significant in the study, broken into F1-F9 </span></span>
<span id="cb27-71"><a href="#cb27-71" aria-hidden="true" tabindex="-1"></a>        <span class="st">'FN'</span>: [<span class="st">'another factor'</span>], <span class="co"># factors not significant in the study, broken into FNS1-FNS4 </span></span>
<span id="cb27-72"><a href="#cb27-72" aria-hidden="true" tabindex="-1"></a>        <span class="st">'limit'</span>: [<span class="st">'geographical context'</span>], <span class="co"># limitations of the study, broken into LIMIT1-LIMIT3 </span></span>
<span id="cb27-73"><a href="#cb27-73" aria-hidden="true" tabindex="-1"></a>        <span class="st">'typeofResearch'</span>: <span class="st">'string'</span>, <span class="co"># type of research conducted in the study </span></span>
<span id="cb27-74"><a href="#cb27-74" aria-hidden="true" tabindex="-1"></a>        <span class="st">'methods'</span>: [<span class="st">'regression analysis'</span>], <span class="co"># methods used in the study, broken into METHOD1-METHOD4</span></span>
<span id="cb27-75"><a href="#cb27-75" aria-hidden="true" tabindex="-1"></a>        <span class="st">'theory'</span>: [<span class="st">'TAM'</span>] <span class="co"># theories used in the study, broken into THEORY1-THEORY4</span></span>
<span id="cb27-76"><a href="#cb27-76" aria-hidden="true" tabindex="-1"></a>        <span class="st">'sampleSize'</span>: <span class="dv">100</span>, <span class="co"># sample size of the study </span></span>
<span id="cb27-77"><a href="#cb27-77" aria-hidden="true" tabindex="-1"></a>        <span class="st">'tech'</span>: <span class="st">'string'</span>, <span class="co"># main technology studied </span></span>
<span id="cb27-78"><a href="#cb27-78" aria-hidden="true" tabindex="-1"></a>        <span class="st">'man_theme'</span>: <span class="st">'string'</span>, <span class="co"># Theme manually assigned by me </span></span>
<span id="cb27-79"><a href="#cb27-79" aria-hidden="true" tabindex="-1"></a>        <span class="st">'algo_theme'</span>: <span class="st">'string'</span>, <span class="co"># Theme assigned by the algorithm </span></span>
<span id="cb27-80"><a href="#cb27-80" aria-hidden="true" tabindex="-1"></a>        <span class="st">'decision_Theme'</span>: <span class="st">'string'</span>, <span class="co"># Final theme of the paper  </span></span>
<span id="cb27-81"><a href="#cb27-81" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Score_Sig'</span>: <span class="fl">0.0</span>, <span class="co"># % of significance for factors </span></span>
<span id="cb27-82"><a href="#cb27-82" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Score_NOT_Sig'</span>: <span class="fl">0.0</span>, <span class="co"># % of non-significance for factors</span></span>
<span id="cb27-83"><a href="#cb27-83" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb27-84"><a href="#cb27-84" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb27-85"><a href="#cb27-85" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-86"><a href="#cb27-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-87"><a href="#cb27-87" aria-hidden="true" tabindex="-1"></a>:::: {.future-idea-box}</span>
<span id="cb27-88"><a href="#cb27-88" aria-hidden="true" tabindex="-1"></a>::: {.future-idea-title} </span>
<span id="cb27-89"><a href="#cb27-89" aria-hidden="true" tabindex="-1"></a>Idea for future</span>
<span id="cb27-90"><a href="#cb27-90" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb27-91"><a href="#cb27-91" aria-hidden="true" tabindex="-1"></a>🤖 Build an Agentic AI application that automates this process. </span>
<span id="cb27-92"><a href="#cb27-92" aria-hidden="true" tabindex="-1"></a>::::</span>
<span id="cb27-93"><a href="#cb27-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-94"><a href="#cb27-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-95"><a href="#cb27-95" aria-hidden="true" tabindex="-1"></a><span class="fu">### Part 1.1 Finding Out Themes </span></span>
<span id="cb27-96"><a href="#cb27-96" aria-hidden="true" tabindex="-1"></a>First, install the following Python modules.</span>
<span id="cb27-97"><a href="#cb27-97" aria-hidden="true" tabindex="-1"></a>I saved the pdf files' name in a dictionary like this: </span>
<span id="cb27-98"><a href="#cb27-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-99"><a href="#cb27-99" aria-hidden="true" tabindex="-1"></a><span class="in">```{python chunk_theme_2}</span></span>
<span id="cb27-100"><a href="#cb27-100" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false </span></span>
<span id="cb27-101"><a href="#cb27-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-102"><a href="#cb27-102" aria-hidden="true" tabindex="-1"></a>name_of_pdfs <span class="op">=</span> {</span>
<span id="cb27-103"><a href="#cb27-103" aria-hidden="true" tabindex="-1"></a>    <span class="st">'p2_01'</span>: <span class="st">"Lonkani et al_2020_A comparative study of trust in mobile banking.pdf"</span>, </span>
<span id="cb27-104"><a href="#cb27-104" aria-hidden="true" tabindex="-1"></a>    <span class="st">'p2_02'</span>: <span class="st">"Saprikis et al_2022_A comparative study of users versus non-users' behavioral intention towards.pdf"</span>, </span>
<span id="cb27-105"><a href="#cb27-105" aria-hidden="true" tabindex="-1"></a>    <span class="st">'p2_03'</span>: <span class="st">"Malaquias et al_2021_A cross-country study on intention to use mobile banking.pdf"</span>, </span>
<span id="cb27-106"><a href="#cb27-106" aria-hidden="true" tabindex="-1"></a>    <span class="st">'p2_04'</span>: <span class="st">"Merhi et al_2019_A cross-cultural study of the intention to use mobile banking between Lebanese.pdf"</span>, </span>
<span id="cb27-107"><a href="#cb27-107" aria-hidden="true" tabindex="-1"></a>    <span class="st">'p2_05'</span>: <span class="st">"Frimpong et al. - 2020 - A cross‐national investigation of trait antecedent.pdf"</span>, </span>
<span id="cb27-108"><a href="#cb27-108" aria-hidden="true" tabindex="-1"></a>    <span class="co"># and so on ... </span></span>
<span id="cb27-109"><a href="#cb27-109" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-110"><a href="#cb27-110" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-111"><a href="#cb27-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-112"><a href="#cb27-112" aria-hidden="true" tabindex="-1"></a>Additionally, I defined a dictionary "look up" for all the factors in the dataset with their related theme that looks like this (shortened for this presentation):</span>
<span id="cb27-113"><a href="#cb27-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-114"><a href="#cb27-114" aria-hidden="true" tabindex="-1"></a><span class="in">```{python chunk_theme_3}</span></span>
<span id="cb27-115"><a href="#cb27-115" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false </span></span>
<span id="cb27-116"><a href="#cb27-116" aria-hidden="true" tabindex="-1"></a>theme_of_words <span class="op">=</span> {</span>
<span id="cb27-117"><a href="#cb27-117" aria-hidden="true" tabindex="-1"></a>    <span class="st">'demographic'</span>: </span>
<span id="cb27-118"><a href="#cb27-118" aria-hidden="true" tabindex="-1"></a>        <span class="bu">list</span>(<span class="bu">set</span>([<span class="st">'women'</span>, <span class="st">'woman'</span>, <span class="st">'female'</span>, <span class="st">'men'</span>, <span class="st">'man'</span>, <span class="st">'male'</span>, <span class="st">'sex'</span>, <span class="st">'gender'</span>, <span class="st">'age'</span>, <span class="st">'income'</span>, </span>
<span id="cb27-119"><a href="#cb27-119" aria-hidden="true" tabindex="-1"></a>            <span class="st">'demographic variables'</span>, <span class="st">'elderly'</span>, <span class="st">'education'</span>, <span class="st">'gender differences'</span>, <span class="st">'generation y'</span>, <span class="st">'millennial generation'</span>,</span>
<span id="cb27-120"><a href="#cb27-120" aria-hidden="true" tabindex="-1"></a>            <span class="st">'millennial'</span>, <span class="st">'gen y'</span>, <span class="st">'gen Z'</span>, <span class="st">'gen alpha'</span>, <span class="st">'gen X'</span>, <span class="st">'boomer'</span>, <span class="st">'babyboomer'</span>, <span class="st">'generation X'</span>, <span class="st">'generation z'</span>,</span>
<span id="cb27-121"><a href="#cb27-121" aria-hidden="true" tabindex="-1"></a>            <span class="st">'young consumers'</span>, </span>
<span id="cb27-122"><a href="#cb27-122" aria-hidden="true" tabindex="-1"></a>            <span class="co"># A lot more factors ...</span></span>
<span id="cb27-123"><a href="#cb27-123" aria-hidden="true" tabindex="-1"></a>            ])),</span>
<span id="cb27-124"><a href="#cb27-124" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-125"><a href="#cb27-125" aria-hidden="true" tabindex="-1"></a>    <span class="co">#----------------------------------------------------------------------------------------------------------------------------------</span></span>
<span id="cb27-126"><a href="#cb27-126" aria-hidden="true" tabindex="-1"></a>    <span class="st">'cultural'</span>: </span>
<span id="cb27-127"><a href="#cb27-127" aria-hidden="true" tabindex="-1"></a>        <span class="bu">list</span>(<span class="bu">set</span>([<span class="st">'developing countries'</span>,<span class="st">'malaysia'</span>,<span class="st">'transition country'</span>,<span class="st">'pakistan'</span>,</span>
<span id="cb27-128"><a href="#cb27-128" aria-hidden="true" tabindex="-1"></a>            <span class="st">'zakat'</span>,<span class="st">'developing country'</span>,<span class="st">'ghana'</span>,<span class="st">'USA'</span>,<span class="st">'srilanka'</span>, <span class="st">'sri lanka'</span>,</span>
<span id="cb27-129"><a href="#cb27-129" aria-hidden="true" tabindex="-1"></a>            <span class="st">'india'</span>,<span class="st">'maldives'</span>,<span class="st">'saudi-arabia'</span>,<span class="st">'saudi arabia'</span>, <span class="st">'nigeria'</span>,<span class="st">'thailand'</span>,<span class="st">'united states'</span>,</span>
<span id="cb27-130"><a href="#cb27-130" aria-hidden="true" tabindex="-1"></a>            <span class="st">'yemen'</span>,<span class="st">'citizenship'</span>,<span class="st">'zimbabwe'</span>,<span class="st">'palestine'</span>,<span class="st">'culture'</span>,</span>
<span id="cb27-131"><a href="#cb27-131" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Country perspective'</span>, </span>
<span id="cb27-132"><a href="#cb27-132" aria-hidden="true" tabindex="-1"></a>            <span class="co"># ... </span></span>
<span id="cb27-133"><a href="#cb27-133" aria-hidden="true" tabindex="-1"></a>            ])),</span>
<span id="cb27-134"><a href="#cb27-134" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-135"><a href="#cb27-135" aria-hidden="true" tabindex="-1"></a>    <span class="co">#----------------------------------------------------------------------------------------------------------------------------------</span></span>
<span id="cb27-136"><a href="#cb27-136" aria-hidden="true" tabindex="-1"></a>    <span class="st">'psychological'</span>:</span>
<span id="cb27-137"><a href="#cb27-137" aria-hidden="true" tabindex="-1"></a>        <span class="bu">list</span>(<span class="bu">set</span>([<span class="st">'anxiety'</span>,<span class="st">'satisfaction'</span>,<span class="st">'behavior'</span>,<span class="st">'behaviour'</span>,<span class="st">'attitudes'</span>,<span class="st">'attitude'</span>,<span class="st">'awareness'</span>,</span>
<span id="cb27-138"><a href="#cb27-138" aria-hidden="true" tabindex="-1"></a>            <span class="st">'technology anxiety'</span>,<span class="st">'consumer-behavior'</span>,<span class="st">'trust'</span>,<span class="st">'benv'</span>,<span class="st">'consumer behaviour'</span>,</span>
<span id="cb27-139"><a href="#cb27-139" aria-hidden="true" tabindex="-1"></a>            <span class="st">'covid-19 related psychological distress'</span>,<span class="st">'psychological distress'</span>,<span class="st">'psychological'</span>,<span class="st">'distress'</span>,</span>
<span id="cb27-140"><a href="#cb27-140" aria-hidden="true" tabindex="-1"></a>            <span class="st">'behavioral'</span>,<span class="st">'computer anxiety'</span>,<span class="st">'customer satisfaction'</span>, <span class="st">'cognitive resistance'</span>,</span>
<span id="cb27-141"><a href="#cb27-141" aria-hidden="true" tabindex="-1"></a>            <span class="co"># A LOT more ... </span></span>
<span id="cb27-142"><a href="#cb27-142" aria-hidden="true" tabindex="-1"></a>            ]))</span>
<span id="cb27-143"><a href="#cb27-143" aria-hidden="true" tabindex="-1"></a>            , </span>
<span id="cb27-144"><a href="#cb27-144" aria-hidden="true" tabindex="-1"></a>            <span class="co"># ... few other key value pairs corresponding to themes </span></span>
<span id="cb27-145"><a href="#cb27-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-146"><a href="#cb27-146" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-147"><a href="#cb27-147" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-148"><a href="#cb27-148" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-149"><a href="#cb27-149" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-150"><a href="#cb27-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-151"><a href="#cb27-151" aria-hidden="true" tabindex="-1"></a>I also needed to delete some stop words, and decided to add more words that I knew would be frequently repeated. I also define the lemmer and stemmer.</span>
<span id="cb27-152"><a href="#cb27-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-153"><a href="#cb27-153" aria-hidden="true" tabindex="-1"></a><span class="in">```{python chunk_theme_4}</span></span>
<span id="cb27-154"><a href="#cb27-154" aria-hidden="true" tabindex="-1"></a>stop_words <span class="op">=</span> stopwords.words(<span class="st">'english'</span>)</span>
<span id="cb27-155"><a href="#cb27-155" aria-hidden="true" tabindex="-1"></a>stop_words.extend([<span class="st">"bank"</span>, <span class="st">"banking"</span>, <span class="st">"banks"</span>, </span>
<span id="cb27-156"><a href="#cb27-156" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"mobile"</span>, <span class="st">"mbank"</span>, <span class="st">"mbanking"</span>, <span class="st">"m-bank"</span>, <span class="st">"m bank"</span>,</span>
<span id="cb27-157"><a href="#cb27-157" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"online"</span>, <span class="st">"e"</span>, <span class="st">"e-bank"</span>, <span class="st">"ebank"</span>, <span class="st">"mobile banking"</span>, <span class="st">"mobile bank"</span>, </span>
<span id="cb27-158"><a href="#cb27-158" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"adoption"</span>, <span class="st">"acceptance"</span>, <span class="st">"accept"</span>, <span class="st">"theory"</span>, </span>
<span id="cb27-159"><a href="#cb27-159" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"purpose"</span>, <span class="st">"result"</span>, <span class="st">"method"</span>, <span class="co">#from abstracts </span></span>
<span id="cb27-160"><a href="#cb27-160" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"journal"</span>, <span class="st">"volume"</span>, <span class="st">"pp"</span>, <span class="st">"no"</span>, <span class="st">"doi"</span>, <span class="st">"http"</span>, <span class="st">"https"</span>, <span class="st">"et al"</span>, <span class="st">"issue"</span>,</span>
<span id="cb27-161"><a href="#cb27-161" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"technology"</span>, <span class="st">"internet"</span>, <span class="st">"information system"</span>, <span class="st">"international information"</span>,</span>
<span id="cb27-162"><a href="#cb27-162" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"information technology"</span>, <span class="st">"computer human"</span>, <span class="st">"mis quarterly"</span>, <span class="st">"electornic commerce"</span>,</span>
<span id="cb27-163"><a href="#cb27-163" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"j market"</span>, <span class="st">"telematics and informatics"</span>, <span class="st">"telematics informatics"</span>, <span class="st">"retail consumer"</span>,</span>
<span id="cb27-164"><a href="#cb27-164" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"international volume"</span>, <span class="st">"international business"</span>, <span class="st">"global information"</span>,</span>
<span id="cb27-165"><a href="#cb27-165" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"et"</span>, <span class="st">"al"</span>, <span class="st">"al."</span>, <span class="st">"tam"</span>, <span class="st">"sem"</span>, <span class="st">"pls"</span>, <span class="st">"utaut"</span>, <span class="st">"tpb"</span>,</span>
<span id="cb27-166"><a href="#cb27-166" aria-hidden="true" tabindex="-1"></a>                   <span class="st">".com"</span>, <span class="st">"management"</span>, <span class="st">"marketing"</span>, <span class="st">"published"</span>, <span class="st">"study"</span>,</span>
<span id="cb27-167"><a href="#cb27-167" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"research"</span>, <span class="st">"literature"</span>, <span class="st">"model"</span>, <span class="co">#from journal information </span></span>
<span id="cb27-168"><a href="#cb27-168" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"app"</span>, <span class="st">"application"</span>, <span class="st">"usage"</span>])</span>
<span id="cb27-169"><a href="#cb27-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-170"><a href="#cb27-170" aria-hidden="true" tabindex="-1"></a>stemmer <span class="op">=</span> PorterStemmer()</span>
<span id="cb27-171"><a href="#cb27-171" aria-hidden="true" tabindex="-1"></a>lemmatizer <span class="op">=</span> WordNetLemmatizer()</span>
<span id="cb27-172"><a href="#cb27-172" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-173"><a href="#cb27-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-174"><a href="#cb27-174" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Set up. </span></span>
<span id="cb27-175"><a href="#cb27-175" aria-hidden="true" tabindex="-1"></a>So, I need a few functions as set up for cleaning the text. Function <span class="in">`extract_text_from_pdf()`</span> is using <span class="in">`PyMuPDF`</span> to extract text from a PDF file.  </span>
<span id="cb27-176"><a href="#cb27-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-177"><a href="#cb27-177" aria-hidden="true" tabindex="-1"></a><span class="in">```{python chunk_theme_5}</span></span>
<span id="cb27-178"><a href="#cb27-178" aria-hidden="true" tabindex="-1"></a><span class="co">#version one using PyMuPDF </span></span>
<span id="cb27-179"><a href="#cb27-179" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> extract_text_from_pdf(filename):</span>
<span id="cb27-180"><a href="#cb27-180" aria-hidden="true" tabindex="-1"></a>    text <span class="op">=</span> <span class="st">""</span></span>
<span id="cb27-181"><a href="#cb27-181" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb27-182"><a href="#cb27-182" aria-hidden="true" tabindex="-1"></a>        doc <span class="op">=</span> fitz.<span class="bu">open</span>(filename)</span>
<span id="cb27-183"><a href="#cb27-183" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> page_num <span class="kw">in</span> <span class="bu">range</span>(doc.page_count):</span>
<span id="cb27-184"><a href="#cb27-184" aria-hidden="true" tabindex="-1"></a>            page <span class="op">=</span> doc.load_page(page_num)</span>
<span id="cb27-185"><a href="#cb27-185" aria-hidden="true" tabindex="-1"></a>            text <span class="op">+=</span> page.get_text()</span>
<span id="cb27-186"><a href="#cb27-186" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb27-187"><a href="#cb27-187" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Error reading </span><span class="sc">{</span>filename<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb27-188"><a href="#cb27-188" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> text</span>
<span id="cb27-189"><a href="#cb27-189" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-190"><a href="#cb27-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-191"><a href="#cb27-191" aria-hidden="true" tabindex="-1"></a>This function is just one of the data cleaning functions: </span>
<span id="cb27-192"><a href="#cb27-192" aria-hidden="true" tabindex="-1"></a>For Topic modeling, I write a function to generate dictionaries and save them in a <span class="in">`.mm`</span> file format. </span>
<span id="cb27-193"><a href="#cb27-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-194"><a href="#cb27-194" aria-hidden="true" tabindex="-1"></a><span class="in">```{python chunk_theme_6}</span></span>
<span id="cb27-195"><a href="#cb27-195" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> generate_dictionary(text, name):</span>
<span id="cb27-196"><a href="#cb27-196" aria-hidden="true" tabindex="-1"></a>    <span class="co">""" </span></span>
<span id="cb27-197"><a href="#cb27-197" aria-hidden="true" tabindex="-1"></a><span class="co">    As input takes in the text to build the dictionary for and the name of a .mm file</span></span>
<span id="cb27-198"><a href="#cb27-198" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span> </span>
<span id="cb27-199"><a href="#cb27-199" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-200"><a href="#cb27-200" aria-hidden="true" tabindex="-1"></a>    dictionary <span class="op">=</span> Dictionary(text)</span>
<span id="cb27-201"><a href="#cb27-201" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-202"><a href="#cb27-202" aria-hidden="true" tabindex="-1"></a>    corpus <span class="op">=</span> [dictionary.doc2bow(review) <span class="cf">for</span> review <span class="kw">in</span> text] </span>
<span id="cb27-203"><a href="#cb27-203" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-204"><a href="#cb27-204" aria-hidden="true" tabindex="-1"></a>    filename <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>name<span class="sc">}</span><span class="ss">.mm"</span></span>
<span id="cb27-205"><a href="#cb27-205" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-206"><a href="#cb27-206" aria-hidden="true" tabindex="-1"></a>    MmCorpus.serialize(filename, corpus)</span>
<span id="cb27-207"><a href="#cb27-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-208"><a href="#cb27-208" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> dictionary, corpus</span>
<span id="cb27-209"><a href="#cb27-209" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-210"><a href="#cb27-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-211"><a href="#cb27-211" aria-hidden="true" tabindex="-1"></a>Additionally, I want a function that prints the top 50 most frequently appearing words in the corpus: </span>
<span id="cb27-212"><a href="#cb27-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-213"><a href="#cb27-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-214"><a href="#cb27-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-215"><a href="#cb27-215" aria-hidden="true" tabindex="-1"></a>I also plan on seeing how python clusters the words (as in, finds similar words) vs me: </span>
<span id="cb27-216"><a href="#cb27-216" aria-hidden="true" tabindex="-1"></a>This is a function for if you want to use a word embedding (requires some effort, time and machine power!):</span>
<span id="cb27-217"><a href="#cb27-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-218"><a href="#cb27-218" aria-hidden="true" tabindex="-1"></a><span class="in">```{python chunk_theme_7}</span></span>
<span id="cb27-219"><a href="#cb27-219" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_embedding(text):</span>
<span id="cb27-220"><a href="#cb27-220" aria-hidden="true" tabindex="-1"></a>    tokenizer <span class="op">=</span> BertTokenizer.from_pretrained(<span class="st">'bert-base-uncased'</span>)</span>
<span id="cb27-221"><a href="#cb27-221" aria-hidden="true" tabindex="-1"></a>    model_bert <span class="op">=</span> BertModel.from_pretrained(<span class="st">'bert-base-uncased'</span>)</span>
<span id="cb27-222"><a href="#cb27-222" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-223"><a href="#cb27-223" aria-hidden="true" tabindex="-1"></a>    inputs <span class="op">=</span> tokenizer(text, return_tensors<span class="op">=</span><span class="st">'pt'</span>, truncation<span class="op">=</span><span class="va">True</span>, padding<span class="op">=</span><span class="va">True</span>, max_length<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb27-224"><a href="#cb27-224" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> torch.no_grad():</span>
<span id="cb27-225"><a href="#cb27-225" aria-hidden="true" tabindex="-1"></a>        outputs <span class="op">=</span> model_bert(<span class="op">**</span>inputs)</span>
<span id="cb27-226"><a href="#cb27-226" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> outputs.last_hidden_state.mean(dim<span class="op">=</span><span class="dv">1</span>).squeeze().numpy()</span>
<span id="cb27-227"><a href="#cb27-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-228"><a href="#cb27-228" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-229"><a href="#cb27-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-230"><a href="#cb27-230" aria-hidden="true" tabindex="-1"></a>And then you use this to get semantically similar words:</span>
<span id="cb27-231"><a href="#cb27-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-232"><a href="#cb27-232" aria-hidden="true" tabindex="-1"></a><span class="in">```{python chunk_theme_8}</span></span>
<span id="cb27-233"><a href="#cb27-233" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_semantically_similar_words(words, threshold<span class="op">=</span><span class="fl">0.7</span>):</span>
<span id="cb27-234"><a href="#cb27-234" aria-hidden="true" tabindex="-1"></a>    similar_words <span class="op">=</span> <span class="bu">set</span>(words)</span>
<span id="cb27-235"><a href="#cb27-235" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> word <span class="kw">in</span> words:</span>
<span id="cb27-236"><a href="#cb27-236" aria-hidden="true" tabindex="-1"></a>        token <span class="op">=</span> nlp(word)</span>
<span id="cb27-237"><a href="#cb27-237" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> vocab_word <span class="kw">in</span> nlp.vocab:</span>
<span id="cb27-238"><a href="#cb27-238" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> vocab_word.has_vector <span class="kw">and</span> vocab_word.is_alpha:</span>
<span id="cb27-239"><a href="#cb27-239" aria-hidden="true" tabindex="-1"></a>                similarity <span class="op">=</span> token.similarity(nlp(vocab_word.text))</span>
<span id="cb27-240"><a href="#cb27-240" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> similarity <span class="op">&gt;=</span> threshold:</span>
<span id="cb27-241"><a href="#cb27-241" aria-hidden="true" tabindex="-1"></a>                    similar_words.add(vocab_word.text)</span>
<span id="cb27-242"><a href="#cb27-242" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> similar_words</span>
<span id="cb27-243"><a href="#cb27-243" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-244"><a href="#cb27-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-245"><a href="#cb27-245" aria-hidden="true" tabindex="-1"></a>So, how do I find the themes? Essentially, I just tweaked TF-IDF:</span>
<span id="cb27-246"><a href="#cb27-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-247"><a href="#cb27-247" aria-hidden="true" tabindex="-1"></a><span class="in">```{python chunk_theme_9}</span></span>
<span id="cb27-248"><a href="#cb27-248" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> CustomTfidfVectorizer(TfidfVectorizer):</span>
<span id="cb27-249"><a href="#cb27-249" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, vocabulary<span class="op">=</span><span class="va">None</span>, <span class="op">**</span>kwargs):</span>
<span id="cb27-250"><a href="#cb27-250" aria-hidden="true" tabindex="-1"></a>        <span class="bu">super</span>().<span class="fu">__init__</span>(vocabulary<span class="op">=</span>vocabulary, <span class="op">**</span>kwargs)</span>
<span id="cb27-251"><a href="#cb27-251" aria-hidden="true" tabindex="-1"></a>        <span class="co">#self.general_keywords = set(general_keywords)</span></span>
<span id="cb27-252"><a href="#cb27-252" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb27-253"><a href="#cb27-253" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> build_analyzer(<span class="va">self</span>):</span>
<span id="cb27-254"><a href="#cb27-254" aria-hidden="true" tabindex="-1"></a>        analyzer <span class="op">=</span> <span class="bu">super</span>().build_analyzer()</span>
<span id="cb27-255"><a href="#cb27-255" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="kw">lambda</span> doc: [w <span class="cf">for</span> w <span class="kw">in</span> analyzer(doc)] <span class="co">#if w not in self.general_keywords]</span></span>
<span id="cb27-256"><a href="#cb27-256" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-257"><a href="#cb27-257" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> fit(<span class="va">self</span>, raw_documents, y<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb27-258"><a href="#cb27-258" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.fit_transform(raw_documents, y)</span>
<span id="cb27-259"><a href="#cb27-259" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span></span>
<span id="cb27-260"><a href="#cb27-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-261"><a href="#cb27-261" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> fit_transform(<span class="va">self</span>, raw_documents, y<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb27-262"><a href="#cb27-262" aria-hidden="true" tabindex="-1"></a>        X <span class="op">=</span> <span class="bu">super</span>().fit_transform(raw_documents, y)</span>
<span id="cb27-263"><a href="#cb27-263" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.max_frequencies <span class="op">=</span> <span class="va">self</span>._compute_max_frequencies(X, raw_documents)</span>
<span id="cb27-264"><a href="#cb27-264" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> X</span>
<span id="cb27-265"><a href="#cb27-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-266"><a href="#cb27-266" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> transform(<span class="va">self</span>, raw_documents):</span>
<span id="cb27-267"><a href="#cb27-267" aria-hidden="true" tabindex="-1"></a>        X <span class="op">=</span> <span class="bu">super</span>().transform(raw_documents)</span>
<span id="cb27-268"><a href="#cb27-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-269"><a href="#cb27-269" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate augmented term frequency</span></span>
<span id="cb27-270"><a href="#cb27-270" aria-hidden="true" tabindex="-1"></a>        max_frequencies <span class="op">=</span> <span class="va">self</span>.max_frequencies</span>
<span id="cb27-271"><a href="#cb27-271" aria-hidden="true" tabindex="-1"></a>        max_frequencies[max_frequencies <span class="op">==</span> <span class="dv">0</span>] <span class="op">=</span> <span class="dv">1</span>  <span class="co"># Avoid division by zero</span></span>
<span id="cb27-272"><a href="#cb27-272" aria-hidden="true" tabindex="-1"></a>        augmented_tf <span class="op">=</span> <span class="fl">0.5</span> <span class="op">+</span> <span class="fl">0.5</span> <span class="op">*</span> (X.toarray() <span class="op">/</span> max_frequencies[:, <span class="va">None</span>])</span>
<span id="cb27-273"><a href="#cb27-273" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb27-274"><a href="#cb27-274" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Penalize general keywords</span></span>
<span id="cb27-275"><a href="#cb27-275" aria-hidden="true" tabindex="-1"></a>        <span class="co">#penalized_idf = self.idf_ * (1 - 0.8 * np.isin(self.get_feature_names_out(), list(self.general_keywords)))</span></span>
<span id="cb27-276"><a href="#cb27-276" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb27-277"><a href="#cb27-277" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Apply penalized IDF</span></span>
<span id="cb27-278"><a href="#cb27-278" aria-hidden="true" tabindex="-1"></a>        augmented_tfidf <span class="op">=</span> augmented_tf <span class="op">*</span> penalized_idf</span>
<span id="cb27-279"><a href="#cb27-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-280"><a href="#cb27-280" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> csr_matrix(augmented_tfidf)</span>
<span id="cb27-281"><a href="#cb27-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-282"><a href="#cb27-282" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _compute_max_frequencies(<span class="va">self</span>, X, raw_documents):</span>
<span id="cb27-283"><a href="#cb27-283" aria-hidden="true" tabindex="-1"></a>        max_frequencies <span class="op">=</span> np.zeros(X.shape[<span class="dv">0</span>])</span>
<span id="cb27-284"><a href="#cb27-284" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i, doc <span class="kw">in</span> <span class="bu">enumerate</span>(raw_documents):</span>
<span id="cb27-285"><a href="#cb27-285" aria-hidden="true" tabindex="-1"></a>            term_freq <span class="op">=</span> {}</span>
<span id="cb27-286"><a href="#cb27-286" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> term <span class="kw">in</span> doc.split():</span>
<span id="cb27-287"><a href="#cb27-287" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> term <span class="kw">in</span> term_freq:</span>
<span id="cb27-288"><a href="#cb27-288" aria-hidden="true" tabindex="-1"></a>                    term_freq[term] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb27-289"><a href="#cb27-289" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb27-290"><a href="#cb27-290" aria-hidden="true" tabindex="-1"></a>                    term_freq[term] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb27-291"><a href="#cb27-291" aria-hidden="true" tabindex="-1"></a>            max_frequencies[i] <span class="op">=</span> <span class="bu">max</span>(term_freq.values())</span>
<span id="cb27-292"><a href="#cb27-292" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> max_frequencies</span>
<span id="cb27-293"><a href="#cb27-293" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-294"><a href="#cb27-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-295"><a href="#cb27-295" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Keyword Analytics </span></span>
<span id="cb27-296"><a href="#cb27-296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-297"><a href="#cb27-297" aria-hidden="true" tabindex="-1"></a><span class="in">```{python chunk_theme_10}</span></span>
<span id="cb27-298"><a href="#cb27-298" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb27-299"><a href="#cb27-299" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.read_csv(<span class="st">"P2_AR_04.csv"</span>, encoding<span class="op">=</span><span class="st">'utf-8'</span>)</span>
<span id="cb27-300"><a href="#cb27-300" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">UnicodeDecodeError</span>:</span>
<span id="cb27-301"><a href="#cb27-301" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb27-302"><a href="#cb27-302" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> pd.read_csv(<span class="st">"P2_AR_04.csv"</span>, encoding<span class="op">=</span><span class="st">'latin-1'</span>)</span>
<span id="cb27-303"><a href="#cb27-303" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb27-304"><a href="#cb27-304" aria-hidden="true" tabindex="-1"></a>        error_message <span class="op">=</span> <span class="bu">str</span>(e)</span>
<span id="cb27-305"><a href="#cb27-305" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> <span class="va">None</span></span>
<span id="cb27-306"><a href="#cb27-306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-307"><a href="#cb27-307" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-308"><a href="#cb27-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-309"><a href="#cb27-309" aria-hidden="true" tabindex="-1"></a>Clean all the data you've gathered the same way the PDF's have been cleaned (the <span class="in">`preprocess_text()`</span> function looks very similar to the cleaning function above!):</span>
<span id="cb27-310"><a href="#cb27-310" aria-hidden="true" tabindex="-1"></a><span class="in">```{python chunk_theme_11}</span></span>
<span id="cb27-311"><a href="#cb27-311" aria-hidden="true" tabindex="-1"></a>df2 <span class="op">=</span> df.copy()</span>
<span id="cb27-312"><a href="#cb27-312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-313"><a href="#cb27-313" aria-hidden="true" tabindex="-1"></a>columns_to_preprocess <span class="op">=</span> [<span class="st">'Man_Theme'</span>,</span>
<span id="cb27-314"><a href="#cb27-314" aria-hidden="true" tabindex="-1"></a>                        <span class="st">'K1'</span>,<span class="st">'K2'</span>,<span class="st">'K3'</span>,<span class="st">'K4'</span>,<span class="st">'K5'</span>,<span class="st">'K6'</span>,<span class="st">'K7'</span>,<span class="st">'K8'</span>,<span class="st">'K9'</span>,<span class="st">'K10'</span>,</span>
<span id="cb27-315"><a href="#cb27-315" aria-hidden="true" tabindex="-1"></a>                        <span class="st">'F1'</span>,<span class="st">'F2'</span>,<span class="st">'F3'</span>,<span class="st">'F4'</span>,<span class="st">'F5'</span>,<span class="st">'F6'</span>,<span class="st">'F7'</span>,<span class="st">'F8'</span>,<span class="st">'F9'</span>,</span>
<span id="cb27-316"><a href="#cb27-316" aria-hidden="true" tabindex="-1"></a>                        <span class="st">'FNS1'</span>,<span class="st">'FNS2'</span>,<span class="st">'FNS3'</span>,<span class="st">'FNS4'</span>,</span>
<span id="cb27-317"><a href="#cb27-317" aria-hidden="true" tabindex="-1"></a>                        <span class="st">'METHOD1'</span>,<span class="st">'METHOD2'</span>,<span class="st">'METHOD3'</span>,<span class="st">'METHOD4'</span>,</span>
<span id="cb27-318"><a href="#cb27-318" aria-hidden="true" tabindex="-1"></a>                        <span class="st">'THEORY1'</span>,<span class="st">'THEORY2'</span>,<span class="st">'THEORY3'</span>,<span class="st">'THEORY4'</span>,</span>
<span id="cb27-319"><a href="#cb27-319" aria-hidden="true" tabindex="-1"></a>                        <span class="st">'LIMIT1'</span> ,<span class="st">'LIMIT2'</span> ,<span class="st">'LIMIT3'</span>, <span class="st">'Abstract'</span></span>
<span id="cb27-320"><a href="#cb27-320" aria-hidden="true" tabindex="-1"></a>                        ]</span>
<span id="cb27-321"><a href="#cb27-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-322"><a href="#cb27-322" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> columns_to_preprocess:</span>
<span id="cb27-323"><a href="#cb27-323" aria-hidden="true" tabindex="-1"></a>    df2[col] <span class="op">=</span> df2[col].<span class="bu">apply</span>(preprocess_text)</span>
<span id="cb27-324"><a href="#cb27-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-325"><a href="#cb27-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-326"><a href="#cb27-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-327"><a href="#cb27-327" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-328"><a href="#cb27-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-329"><a href="#cb27-329" aria-hidden="true" tabindex="-1"></a><span class="in">```{python chunk_theme_12}</span></span>
<span id="cb27-330"><a href="#cb27-330" aria-hidden="true" tabindex="-1"></a>papers <span class="op">=</span> {}</span>
<span id="cb27-331"><a href="#cb27-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-332"><a href="#cb27-332" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> paper_id, filename <span class="kw">in</span> name_of_pdfs.items():</span>
<span id="cb27-333"><a href="#cb27-333" aria-hidden="true" tabindex="-1"></a>    text <span class="op">=</span> extract_text_from_pdf(filename)</span>
<span id="cb27-334"><a href="#cb27-334" aria-hidden="true" tabindex="-1"></a>    papers[paper_id] <span class="op">=</span> text</span>
<span id="cb27-335"><a href="#cb27-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-336"><a href="#cb27-336" aria-hidden="true" tabindex="-1"></a>papers_df <span class="op">=</span> pd.DataFrame.from_dict(papers, orient <span class="op">=</span> <span class="st">'index'</span>, columns <span class="op">=</span> [<span class="st">'paperText'</span>])</span>
<span id="cb27-337"><a href="#cb27-337" aria-hidden="true" tabindex="-1"></a>papers_df <span class="op">=</span> papers_df.reset_index(names <span class="op">=</span> [<span class="st">'paperID'</span>])</span>
<span id="cb27-338"><a href="#cb27-338" aria-hidden="true" tabindex="-1"></a>papers_df.to_csv(<span class="st">'papers_unclean.csv'</span>)</span>
<span id="cb27-339"><a href="#cb27-339" aria-hidden="true" tabindex="-1"></a>papers_df.head()</span>
<span id="cb27-340"><a href="#cb27-340" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-341"><a href="#cb27-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-342"><a href="#cb27-342" aria-hidden="true" tabindex="-1"></a>These look like this: </span>
<span id="cb27-343"><a href="#cb27-343" aria-hidden="true" tabindex="-1"></a><span class="al">![](/images/uncleanData.png)</span></span>
<span id="cb27-344"><a href="#cb27-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-345"><a href="#cb27-345" aria-hidden="true" tabindex="-1"></a><span class="in">```{python chunk_theme_13}</span></span>
<span id="cb27-346"><a href="#cb27-346" aria-hidden="true" tabindex="-1"></a><span class="co"># keep a copy (a habit of mine)</span></span>
<span id="cb27-347"><a href="#cb27-347" aria-hidden="true" tabindex="-1"></a>papers_uncleaned <span class="op">=</span> papers.copy() </span>
<span id="cb27-348"><a href="#cb27-348" aria-hidden="true" tabindex="-1"></a>theme_of_words_uncleaned <span class="op">=</span> theme_of_words.copy() </span>
<span id="cb27-349"><a href="#cb27-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-350"><a href="#cb27-350" aria-hidden="true" tabindex="-1"></a><span class="co"># clean up all papers </span></span>
<span id="cb27-351"><a href="#cb27-351" aria-hidden="true" tabindex="-1"></a>papers_cleaned <span class="op">=</span> preprocess_Dict(papers)</span>
<span id="cb27-352"><a href="#cb27-352" aria-hidden="true" tabindex="-1"></a>papersClean_df <span class="op">=</span> pd.DataFrame.from_dict(papers_cleaned, orient <span class="op">=</span> <span class="st">'index'</span>, columns <span class="op">=</span> [<span class="st">'paperText'</span>])</span>
<span id="cb27-353"><a href="#cb27-353" aria-hidden="true" tabindex="-1"></a>papersClean_df <span class="op">=</span> papersClean_df.reset_index(names <span class="op">=</span> [<span class="st">'paperID'</span>])</span>
<span id="cb27-354"><a href="#cb27-354" aria-hidden="true" tabindex="-1"></a>papersClean_df.to_csv(<span class="st">'papers_clean3.csv'</span>)</span>
<span id="cb27-355"><a href="#cb27-355" aria-hidden="true" tabindex="-1"></a>papersClean_df.head()</span>
<span id="cb27-356"><a href="#cb27-356" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-357"><a href="#cb27-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-358"><a href="#cb27-358" aria-hidden="true" tabindex="-1"></a><span class="al">![](/images/cleaned_paper.png)</span></span>
<span id="cb27-359"><a href="#cb27-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-360"><a href="#cb27-360" aria-hidden="true" tabindex="-1"></a>Clean the theme of words dictionary so the words match: </span>
<span id="cb27-361"><a href="#cb27-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-362"><a href="#cb27-362" aria-hidden="true" tabindex="-1"></a><span class="in">```{python chunk_theme_14}</span></span>
<span id="cb27-363"><a href="#cb27-363" aria-hidden="true" tabindex="-1"></a>theme_of_words_cleaned <span class="op">=</span> {}</span>
<span id="cb27-364"><a href="#cb27-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-365"><a href="#cb27-365" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k, v <span class="kw">in</span> theme_of_words.items():</span>
<span id="cb27-366"><a href="#cb27-366" aria-hidden="true" tabindex="-1"></a>    theme_of_words_cleaned[k] <span class="op">=</span> preprocess_list(v)</span>
<span id="cb27-367"><a href="#cb27-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-368"><a href="#cb27-368" aria-hidden="true" tabindex="-1"></a>theme_of_words_cleaned[<span class="st">'psychological'</span>][:<span class="dv">10</span>]</span>
<span id="cb27-369"><a href="#cb27-369" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-370"><a href="#cb27-370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-371"><a href="#cb27-371" aria-hidden="true" tabindex="-1"></a><span class="at">&gt;&gt;&gt; </span><span class="co">[</span><span class="ot">'initial trst','simcong','hedmotiv','selfefficacy','strss','controlled motiv','cong','selfcong cong','trst systems','custom loyalti'</span><span class="co">]</span></span>
<span id="cb27-372"><a href="#cb27-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-373"><a href="#cb27-373" aria-hidden="true" tabindex="-1"></a>Make sure to drop all NA's and empty values: </span>
<span id="cb27-374"><a href="#cb27-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-375"><a href="#cb27-375" aria-hidden="true" tabindex="-1"></a><span class="in">```{python chunk_theme_15}</span></span>
<span id="cb27-376"><a href="#cb27-376" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k, v <span class="kw">in</span> theme_of_words_cleaned.items():</span>
<span id="cb27-377"><a href="#cb27-377" aria-hidden="true" tabindex="-1"></a>    theme_of_words_cleaned[k] <span class="op">=</span> [x <span class="cf">for</span> x <span class="kw">in</span> v <span class="cf">if</span> x <span class="kw">not</span> <span class="kw">in</span> [<span class="va">None</span>, <span class="st">""</span>, <span class="st">' '</span>, <span class="st">'NaN'</span>] <span class="kw">and</span> <span class="kw">not</span> (<span class="bu">isinstance</span>(x, <span class="bu">float</span>) <span class="kw">and</span> math.isnan(x))]</span>
<span id="cb27-378"><a href="#cb27-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-379"><a href="#cb27-379" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-380"><a href="#cb27-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-381"><a href="#cb27-381" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Themes Based on Count of Words in Each Group </span></span>
<span id="cb27-382"><a href="#cb27-382" aria-hidden="true" tabindex="-1"></a>I will skip the parts on BERT and word embeddings that's in the jupyter notebook as these were not used for my project. </span>
<span id="cb27-383"><a href="#cb27-383" aria-hidden="true" tabindex="-1"></a>The reason is that it was taking so long and my computer simply did not have the capacity to handle it. </span>
<span id="cb27-384"><a href="#cb27-384" aria-hidden="true" tabindex="-1"></a>I also didn't have the time to find a fix for it, but there are a bunch of commented-out code from chatGPT that I was playing around with. </span>
<span id="cb27-385"><a href="#cb27-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-386"><a href="#cb27-386" aria-hidden="true" tabindex="-1"></a>So, we now have a dictionary with the factors and their theme, and a corpus of text of all papers in the dataset. </span>
<span id="cb27-387"><a href="#cb27-387" aria-hidden="true" tabindex="-1"></a>What I'm going to do here is: </span>
<span id="cb27-388"><a href="#cb27-388" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Count all the words <span class="in">`total_words`</span> in each paper </span>
<span id="cb27-389"><a href="#cb27-389" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Count the instances of each word (factor) in <span class="in">`theme_of_words_cleaned`</span> in each paper </span>
<span id="cb27-390"><a href="#cb27-390" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Each word's count adds 1 point to its corresponding theme's "weight score" </span>
<span id="cb27-391"><a href="#cb27-391" aria-hidden="true" tabindex="-1"></a><span class="ss">  * </span>Take for example the word **emotion** and I said the theme for this word is **psychological**. If emotion shows up 10 times in paper 1, paper 1's dictionary of weights has a weight of 10 for (divided by the total number of words) psychological. </span>
<span id="cb27-392"><a href="#cb27-392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-393"><a href="#cb27-393" aria-hidden="true" tabindex="-1"></a><span class="in">```{python chunk_theme_16}</span></span>
<span id="cb27-394"><a href="#cb27-394" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> []</span>
<span id="cb27-395"><a href="#cb27-395" aria-hidden="true" tabindex="-1"></a>count_words_df <span class="op">=</span> pd.DataFrame(results)</span>
<span id="cb27-396"><a href="#cb27-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-397"><a href="#cb27-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-398"><a href="#cb27-398" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> doc_id, text <span class="kw">in</span> papers_cleaned.items():</span>
<span id="cb27-399"><a href="#cb27-399" aria-hidden="true" tabindex="-1"></a>    doc <span class="op">=</span> nlp(text)</span>
<span id="cb27-400"><a href="#cb27-400" aria-hidden="true" tabindex="-1"></a>    word_counts <span class="op">=</span> defaultdict(<span class="bu">int</span>)</span>
<span id="cb27-401"><a href="#cb27-401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-402"><a href="#cb27-402" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> token <span class="kw">in</span> doc:</span>
<span id="cb27-403"><a href="#cb27-403" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> group, keywords <span class="kw">in</span> theme_of_words_cleaned.items():</span>
<span id="cb27-404"><a href="#cb27-404" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> token.text.lower() <span class="kw">in</span> keywords:</span>
<span id="cb27-405"><a href="#cb27-405" aria-hidden="true" tabindex="-1"></a>                word_counts[group] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb27-406"><a href="#cb27-406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-407"><a href="#cb27-407" aria-hidden="true" tabindex="-1"></a>    total_words <span class="op">=</span> <span class="bu">len</span>(doc)</span>
<span id="cb27-408"><a href="#cb27-408" aria-hidden="true" tabindex="-1"></a>    group_weights <span class="op">=</span> {<span class="ss">f"</span><span class="sc">{</span>group<span class="sc">}</span><span class="ss">_w"</span>: count <span class="op">/</span> total_words <span class="cf">for</span> group, count <span class="kw">in</span> word_counts.items()}</span>
<span id="cb27-409"><a href="#cb27-409" aria-hidden="true" tabindex="-1"></a>    max_weight <span class="op">=</span> <span class="bu">max</span>(group_weights.values(), default<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb27-410"><a href="#cb27-410" aria-hidden="true" tabindex="-1"></a>    theme <span class="op">=</span> <span class="bu">max</span>(group_weights, key<span class="op">=</span>group_weights.get).replace(<span class="st">"_w"</span>, <span class="st">""</span>) <span class="cf">if</span> max_weight <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="va">None</span></span>
<span id="cb27-411"><a href="#cb27-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-412"><a href="#cb27-412" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> {<span class="st">"doc_id"</span>: doc_id, <span class="op">**</span>word_counts, <span class="op">**</span>group_weights, <span class="st">"theme"</span>: theme, <span class="st">"max_weight"</span>: max_weight}</span>
<span id="cb27-413"><a href="#cb27-413" aria-hidden="true" tabindex="-1"></a>    results.append(result)</span>
<span id="cb27-414"><a href="#cb27-414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-415"><a href="#cb27-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-416"><a href="#cb27-416" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> group <span class="kw">in</span> theme_of_words_cleaned.keys():</span>
<span id="cb27-417"><a href="#cb27-417" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> group <span class="kw">not</span> <span class="kw">in</span> count_words_df.columns:</span>
<span id="cb27-418"><a href="#cb27-418" aria-hidden="true" tabindex="-1"></a>        count_words_df[group] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb27-419"><a href="#cb27-419" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="ss">f"</span><span class="sc">{</span>group<span class="sc">}</span><span class="ss">_w"</span> <span class="kw">not</span> <span class="kw">in</span> count_words_df.columns:</span>
<span id="cb27-420"><a href="#cb27-420" aria-hidden="true" tabindex="-1"></a>        count_words_df[<span class="ss">f"</span><span class="sc">{</span>group<span class="sc">}</span><span class="ss">_w"</span>] <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb27-421"><a href="#cb27-421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-422"><a href="#cb27-422" aria-hidden="true" tabindex="-1"></a>count_words_df.head()</span>
<span id="cb27-423"><a href="#cb27-423" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-424"><a href="#cb27-424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-425"><a href="#cb27-425" aria-hidden="true" tabindex="-1"></a><span class="al">![](/images/count_words_df.png)</span></span>
<span id="cb27-426"><a href="#cb27-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-427"><a href="#cb27-427" aria-hidden="true" tabindex="-1"></a>This is still very basic, though because it's only based on the factors which may not be fully representative.</span>
<span id="cb27-428"><a href="#cb27-428" aria-hidden="true" tabindex="-1"></a>So, I do this again using keywords in addition to the factors.</span>
<span id="cb27-429"><a href="#cb27-429" aria-hidden="true" tabindex="-1"></a>These are keywords that were selected by the authors as well as information extracted from Web of Science $\BibTeX$ file. </span>
<span id="cb27-430"><a href="#cb27-430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-431"><a href="#cb27-431" aria-hidden="true" tabindex="-1"></a><span class="in">```{python chunk_theme_17}</span></span>
<span id="cb27-432"><a href="#cb27-432" aria-hidden="true" tabindex="-1"></a>cols_toPick <span class="op">=</span> [<span class="st">'K1'</span>,<span class="st">'K2'</span>,<span class="st">'K3'</span>,<span class="st">'K4'</span>,<span class="st">'K5'</span>,<span class="st">'K6'</span>,<span class="st">'K7'</span>,<span class="st">'K8'</span>,<span class="st">'K9'</span>,<span class="st">'K10'</span>,<span class="st">'F1'</span>,<span class="st">'F2'</span>,<span class="st">'F3'</span>,<span class="st">'F4'</span>,<span class="st">'F5'</span>,<span class="st">'F6'</span>,<span class="st">'F7'</span>,<span class="st">'F8'</span>,<span class="st">'F9'</span>]</span>
<span id="cb27-433"><a href="#cb27-433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-434"><a href="#cb27-434" aria-hidden="true" tabindex="-1"></a>keywordsDf <span class="op">=</span> df2.loc[:,cols_toPick]</span>
<span id="cb27-435"><a href="#cb27-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-436"><a href="#cb27-436" aria-hidden="true" tabindex="-1"></a><span class="co"># flatten the dataframe to a list </span></span>
<span id="cb27-437"><a href="#cb27-437" aria-hidden="true" tabindex="-1"></a>keywords_across_db <span class="op">=</span> keywordsDf.values.flatten().tolist()</span>
<span id="cb27-438"><a href="#cb27-438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-439"><a href="#cb27-439" aria-hidden="true" tabindex="-1"></a><span class="co"># there are 2,717 words here </span></span>
<span id="cb27-440"><a href="#cb27-440" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"number of words (factors and keywords) in total "</span>, <span class="bu">len</span>(keywords_across_db))</span>
<span id="cb27-441"><a href="#cb27-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-442"><a href="#cb27-442" aria-hidden="true" tabindex="-1"></a><span class="co"># making sure there are no empty/NaN/Null values </span></span>
<span id="cb27-443"><a href="#cb27-443" aria-hidden="true" tabindex="-1"></a>keywords_across_db <span class="op">=</span> [x <span class="cf">for</span> x <span class="kw">in</span> keywords_across_db <span class="cf">if</span> x <span class="kw">not</span> <span class="kw">in</span> [<span class="va">None</span>, <span class="st">""</span>, <span class="st">' '</span>, <span class="st">'NaN'</span>] <span class="kw">and</span> <span class="kw">not</span> (<span class="bu">isinstance</span>(x, <span class="bu">float</span>) <span class="kw">and</span> math.isnan(x))]</span>
<span id="cb27-444"><a href="#cb27-444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-445"><a href="#cb27-445" aria-hidden="true" tabindex="-1"></a><span class="co"># making sure there are no duplicates (set takes care of this)</span></span>
<span id="cb27-446"><a href="#cb27-446" aria-hidden="true" tabindex="-1"></a>keywords_across_db_nodup_cleaned <span class="op">=</span> <span class="bu">list</span>(<span class="bu">set</span>(keywords_across_db))</span>
<span id="cb27-447"><a href="#cb27-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-448"><a href="#cb27-448" aria-hidden="true" tabindex="-1"></a><span class="co"># convert the list into a dictionary temporarily, then convert it to a dataframe </span></span>
<span id="cb27-449"><a href="#cb27-449" aria-hidden="true" tabindex="-1"></a>temp <span class="op">=</span> {<span class="st">'Keyword'</span>: keywords_across_db_nodup_cleaned}</span>
<span id="cb27-450"><a href="#cb27-450" aria-hidden="true" tabindex="-1"></a>keywords_themes_df <span class="op">=</span> pd.DataFrame(temp, columns<span class="op">=</span>[<span class="st">'Keyword'</span>])</span>
<span id="cb27-451"><a href="#cb27-451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-452"><a href="#cb27-452" aria-hidden="true" tabindex="-1"></a><span class="co"># go back to the theme_of_words_cleaned and find each keyword's theme </span></span>
<span id="cb27-453"><a href="#cb27-453" aria-hidden="true" tabindex="-1"></a>keywords_themes_dic <span class="op">=</span> {keyword: theme <span class="cf">for</span> theme, keywords <span class="kw">in</span> theme_of_words_cleaned.items() <span class="cf">for</span> keyword <span class="kw">in</span> keywords}</span>
<span id="cb27-454"><a href="#cb27-454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-455"><a href="#cb27-455" aria-hidden="true" tabindex="-1"></a><span class="co"># This is just a dataframe view of the keywords with their respective theme </span></span>
<span id="cb27-456"><a href="#cb27-456" aria-hidden="true" tabindex="-1"></a>keywords_themes_df[<span class="st">'Theme'</span>] <span class="op">=</span> keywords_themes_df[<span class="st">'Keyword'</span>].<span class="bu">map</span>(keywords_themes_dic)</span>
<span id="cb27-457"><a href="#cb27-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-458"><a href="#cb27-458" aria-hidden="true" tabindex="-1"></a><span class="co"># if the theme is empty, give it "Generic" - that means these keywords weren't in the list of important words that we picked themes for </span></span>
<span id="cb27-459"><a href="#cb27-459" aria-hidden="true" tabindex="-1"></a>keywords_themes_df[<span class="st">'Theme'</span>] <span class="op">=</span> keywords_themes_df[<span class="st">'Theme'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="st">'Generic'</span> <span class="cf">if</span> pd.isna(x) <span class="kw">or</span> x <span class="op">==</span> <span class="st">' '</span> <span class="cf">else</span> x)</span>
<span id="cb27-460"><a href="#cb27-460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-461"><a href="#cb27-461" aria-hidden="true" tabindex="-1"></a>keywords_themes_df.head()</span>
<span id="cb27-462"><a href="#cb27-462" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-463"><a href="#cb27-463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-464"><a href="#cb27-464" aria-hidden="true" tabindex="-1"></a><span class="al">![](/images/keywordtheme.png)</span></span>
<span id="cb27-465"><a href="#cb27-465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-466"><a href="#cb27-466" aria-hidden="true" tabindex="-1"></a>I'm gonna get rid of all the Generic keywords, so keeping a copy of this dataframe: </span>
<span id="cb27-467"><a href="#cb27-467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-468"><a href="#cb27-468" aria-hidden="true" tabindex="-1"></a><span class="in">```{python chunk_theme_18}</span></span>
<span id="cb27-469"><a href="#cb27-469" aria-hidden="true" tabindex="-1"></a>keywords_themes_df_withGenerics <span class="op">=</span> keywords_themes_df.copy()</span>
<span id="cb27-470"><a href="#cb27-470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-471"><a href="#cb27-471" aria-hidden="true" tabindex="-1"></a>keywords_themes_df[<span class="st">'Theme'</span>] <span class="op">=</span> keywords_themes_df[<span class="st">'Theme'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="st">'Generic'</span> <span class="cf">if</span> pd.isna(x) <span class="kw">or</span> x <span class="op">==</span> <span class="st">' '</span> <span class="cf">else</span> x)</span>
<span id="cb27-472"><a href="#cb27-472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-473"><a href="#cb27-473" aria-hidden="true" tabindex="-1"></a><span class="co"># everything but generic </span></span>
<span id="cb27-474"><a href="#cb27-474" aria-hidden="true" tabindex="-1"></a>keywords_themes_df <span class="op">=</span> keywords_themes_df.loc[keywords_themes_df[<span class="st">'Theme'</span>] <span class="op">!=</span> <span class="st">'Generic'</span>]</span>
<span id="cb27-475"><a href="#cb27-475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-476"><a href="#cb27-476" aria-hidden="true" tabindex="-1"></a><span class="co"># flatten it to build a vocabulary </span></span>
<span id="cb27-477"><a href="#cb27-477" aria-hidden="true" tabindex="-1"></a>words_acrossAll_nonGeneric <span class="op">=</span> keywords_themes_df[<span class="st">'Keyword'</span>].values.flatten().tolist()</span>
<span id="cb27-478"><a href="#cb27-478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-479"><a href="#cb27-479" aria-hidden="true" tabindex="-1"></a><span class="co"># making sure no null values were generated </span></span>
<span id="cb27-480"><a href="#cb27-480" aria-hidden="true" tabindex="-1"></a>words_acrossAll_nonGeneric <span class="op">=</span> [x <span class="cf">for</span> x <span class="kw">in</span> words_acrossAll_nonGeneric <span class="cf">if</span> x <span class="kw">not</span> <span class="kw">in</span> [<span class="va">None</span>, <span class="st">""</span>, <span class="st">' '</span>, <span class="st">'NaN'</span>] <span class="kw">and</span> <span class="kw">not</span> (<span class="bu">isinstance</span>(x, <span class="bu">float</span>) <span class="kw">and</span> math.isnan(x))]</span>
<span id="cb27-481"><a href="#cb27-481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-482"><a href="#cb27-482" aria-hidden="true" tabindex="-1"></a><span class="co"># making sure there are no dulicates (233 words total)</span></span>
<span id="cb27-483"><a href="#cb27-483" aria-hidden="true" tabindex="-1"></a>words_acrossAll_nonGeneric <span class="op">=</span> <span class="bu">list</span>(<span class="bu">set</span>(words_acrossAll_nonGeneric))</span>
<span id="cb27-484"><a href="#cb27-484" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-485"><a href="#cb27-485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-486"><a href="#cb27-486" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Theme Assignment </span></span>
<span id="cb27-487"><a href="#cb27-487" aria-hidden="true" tabindex="-1"></a>I will now use the custom TF-IDF class to generate a TF-IDF matrix.</span>
<span id="cb27-488"><a href="#cb27-488" aria-hidden="true" tabindex="-1"></a>This is similar to what I did by hand a bit further above. </span>
<span id="cb27-489"><a href="#cb27-489" aria-hidden="true" tabindex="-1"></a>Basically, all TF-IDF is doing is counting the frequency of words across the document. </span>
<span id="cb27-490"><a href="#cb27-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-491"><a href="#cb27-491" aria-hidden="true" tabindex="-1"></a><span class="in">```{python chunk_theme_19}</span></span>
<span id="cb27-492"><a href="#cb27-492" aria-hidden="true" tabindex="-1"></a>vectorizer_keys <span class="op">=</span> CustomTfidfVectorizer(vocabulary <span class="op">=</span> words_acrossAll_nonGeneric)</span>
<span id="cb27-493"><a href="#cb27-493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-494"><a href="#cb27-494" aria-hidden="true" tabindex="-1"></a>tfidf_matrix <span class="op">=</span> vectorizer_keys.fit_transform(papers_cleaned.values())</span>
<span id="cb27-495"><a href="#cb27-495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-496"><a href="#cb27-496" aria-hidden="true" tabindex="-1"></a>tfidf_df <span class="op">=</span> pd.DataFrame(tfidf_matrix.toarray(), index <span class="op">=</span> papers_cleaned.keys(), columns<span class="op">=</span>vectorizer_keys.get_feature_names_out())</span>
<span id="cb27-497"><a href="#cb27-497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-498"><a href="#cb27-498" aria-hidden="true" tabindex="-1"></a>tfidf_df.head()</span>
<span id="cb27-499"><a href="#cb27-499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-500"><a href="#cb27-500" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-501"><a href="#cb27-501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-502"><a href="#cb27-502" aria-hidden="true" tabindex="-1"></a><span class="al">![](/images/tfidf_head1.png)</span></span>
<span id="cb27-503"><a href="#cb27-503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-504"><a href="#cb27-504" aria-hidden="true" tabindex="-1"></a>Now using TF-IDF scores, finding the weights for themes for each paper: </span>
<span id="cb27-505"><a href="#cb27-505" aria-hidden="true" tabindex="-1"></a><span class="in">```{python chunk_theme_20}</span></span>
<span id="cb27-506"><a href="#cb27-506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-507"><a href="#cb27-507" aria-hidden="true" tabindex="-1"></a>keyword_to_theme <span class="op">=</span> {keyword: theme <span class="cf">for</span> theme, keywords <span class="kw">in</span> theme_of_words_cleaned.items() <span class="cf">for</span> keyword <span class="kw">in</span> keywords}</span>
<span id="cb27-508"><a href="#cb27-508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-509"><a href="#cb27-509" aria-hidden="true" tabindex="-1"></a>theme_weights <span class="op">=</span> pd.DataFrame(<span class="dv">0</span>, index<span class="op">=</span>tfidf_df.index, columns<span class="op">=</span>theme_of_words_cleaned.keys())</span>
<span id="cb27-510"><a href="#cb27-510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-511"><a href="#cb27-511" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> keyword, theme <span class="kw">in</span> keyword_to_theme.items():</span>
<span id="cb27-512"><a href="#cb27-512" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> keyword <span class="kw">in</span> tfidf_df.columns:</span>
<span id="cb27-513"><a href="#cb27-513" aria-hidden="true" tabindex="-1"></a>        theme_weights[theme] <span class="op">+=</span> tfidf_df[keyword]</span>
<span id="cb27-514"><a href="#cb27-514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-515"><a href="#cb27-515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-516"><a href="#cb27-516" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> _, row <span class="kw">in</span> df2.iterrows():</span>
<span id="cb27-517"><a href="#cb27-517" aria-hidden="true" tabindex="-1"></a>    paper_id <span class="op">=</span> row[<span class="st">'ID'</span>]</span>
<span id="cb27-518"><a href="#cb27-518" aria-hidden="true" tabindex="-1"></a>    keywords <span class="op">=</span> words_acrossAll_nonGeneric </span>
<span id="cb27-519"><a href="#cb27-519" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-520"><a href="#cb27-520" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> keyword <span class="kw">in</span> keywords:</span>
<span id="cb27-521"><a href="#cb27-521" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> keyword <span class="kw">in</span> tfidf_df.columns:</span>
<span id="cb27-522"><a href="#cb27-522" aria-hidden="true" tabindex="-1"></a>            theme <span class="op">=</span> keyword_to_theme.get(keyword, <span class="va">None</span>)</span>
<span id="cb27-523"><a href="#cb27-523" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> theme:</span>
<span id="cb27-524"><a href="#cb27-524" aria-hidden="true" tabindex="-1"></a>                <span class="co">#if theme in tfidf_df.index:</span></span>
<span id="cb27-525"><a href="#cb27-525" aria-hidden="true" tabindex="-1"></a>                theme_weights.at[paper_id, theme] <span class="op">+=</span> tfidf_df.at[paper_id, keyword] <span class="op">*</span> <span class="dv">5</span>  </span>
<span id="cb27-526"><a href="#cb27-526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-527"><a href="#cb27-527" aria-hidden="true" tabindex="-1"></a><span class="co"># this is picking just 1 theme per paper - find the theme with the maximum weight as the main theme of the paper </span></span>
<span id="cb27-528"><a href="#cb27-528" aria-hidden="true" tabindex="-1"></a>main_theme_df <span class="op">=</span> theme_weights.<span class="bu">apply</span>(<span class="kw">lambda</span> row: (row <span class="op">==</span> row.<span class="bu">max</span>()).astype(<span class="bu">int</span>), axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb27-529"><a href="#cb27-529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-530"><a href="#cb27-530" aria-hidden="true" tabindex="-1"></a>main_theme_df.head()</span>
<span id="cb27-531"><a href="#cb27-531" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-532"><a href="#cb27-532" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-533"><a href="#cb27-533" aria-hidden="true" tabindex="-1"></a><span class="al">![](/images/theme_pick1.png)</span></span>
<span id="cb27-534"><a href="#cb27-534" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-535"><a href="#cb27-535" aria-hidden="true" tabindex="-1"></a>Visualizing this: </span>
<span id="cb27-536"><a href="#cb27-536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-537"><a href="#cb27-537" aria-hidden="true" tabindex="-1"></a><span class="in">```{python chunk_theme_21}</span></span>
<span id="cb27-538"><a href="#cb27-538" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(nrows<span class="op">=</span><span class="dv">2</span>, ncols<span class="op">=</span><span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">20</span>, <span class="dv">10</span>))</span>
<span id="cb27-539"><a href="#cb27-539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-540"><a href="#cb27-540" aria-hidden="true" tabindex="-1"></a><span class="co"># Heatmap for theme weights</span></span>
<span id="cb27-541"><a href="#cb27-541" aria-hidden="true" tabindex="-1"></a>sns.heatmap(theme_weights.T, ax<span class="op">=</span>axes[<span class="dv">0</span>], cmap<span class="op">=</span><span class="st">"YlGnBu_r"</span>, cbar_kws<span class="op">=</span>{<span class="st">'label'</span>: <span class="st">'Weight'</span>})</span>
<span id="cb27-542"><a href="#cb27-542" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_xlabel(<span class="st">"Paper ID"</span>)</span>
<span id="cb27-543"><a href="#cb27-543" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_ylabel(<span class="st">"Theme"</span>)</span>
<span id="cb27-544"><a href="#cb27-544" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_title(<span class="st">"Theme Weights per Paper"</span>)</span>
<span id="cb27-545"><a href="#cb27-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-546"><a href="#cb27-546" aria-hidden="true" tabindex="-1"></a><span class="co"># Heatmap for main themes</span></span>
<span id="cb27-547"><a href="#cb27-547" aria-hidden="true" tabindex="-1"></a>sns.heatmap(main_theme_df.T, ax<span class="op">=</span>axes[<span class="dv">1</span>], cmap<span class="op">=</span><span class="st">"YlGnBu_r"</span>, cbar_kws<span class="op">=</span>{<span class="st">'label'</span>: <span class="st">'Theme Presence'</span>})</span>
<span id="cb27-548"><a href="#cb27-548" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_xlabel(<span class="st">"Paper ID"</span>)</span>
<span id="cb27-549"><a href="#cb27-549" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_ylabel(<span class="st">"Theme"</span>)</span>
<span id="cb27-550"><a href="#cb27-550" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_title(<span class="st">"Main Theme per Paper"</span>)</span>
<span id="cb27-551"><a href="#cb27-551" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-552"><a href="#cb27-552" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb27-553"><a href="#cb27-553" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb27-554"><a href="#cb27-554" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">'main_themes_heatmap_1.png'</span>)</span>
<span id="cb27-555"><a href="#cb27-555" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-556"><a href="#cb27-556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-557"><a href="#cb27-557" aria-hidden="true" tabindex="-1"></a><span class="al">![](/images/main_themes_heatmap_1.png)</span></span>
<span id="cb27-558"><a href="#cb27-558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-559"><a href="#cb27-559" aria-hidden="true" tabindex="-1"></a>To extract the themes easily:</span>
<span id="cb27-560"><a href="#cb27-560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-561"><a href="#cb27-561" aria-hidden="true" tabindex="-1"></a><span class="in">```{python chunk_theme_22}</span></span>
<span id="cb27-562"><a href="#cb27-562" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract themes for each paper</span></span>
<span id="cb27-563"><a href="#cb27-563" aria-hidden="true" tabindex="-1"></a>themes_for_papers <span class="op">=</span> {</span>
<span id="cb27-564"><a href="#cb27-564" aria-hidden="true" tabindex="-1"></a>    paper_id: main_theme_df.columns[row.astype(<span class="bu">bool</span>)].tolist()</span>
<span id="cb27-565"><a href="#cb27-565" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> paper_id, row <span class="kw">in</span> main_theme_df.iterrows()</span>
<span id="cb27-566"><a href="#cb27-566" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-567"><a href="#cb27-567" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-568"><a href="#cb27-568" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the themes for each paper</span></span>
<span id="cb27-569"><a href="#cb27-569" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> paper_id, themes <span class="kw">in</span> themes_for_papers.items():</span>
<span id="cb27-570"><a href="#cb27-570" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Paper ID: </span><span class="sc">{</span>paper_id<span class="sc">}</span><span class="ss">, Themes: </span><span class="sc">{</span><span class="st">', '</span><span class="sc">.</span>join(themes)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb27-571"><a href="#cb27-571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-572"><a href="#cb27-572" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-573"><a href="#cb27-573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-574"><a href="#cb27-574" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Paper ID: p2_01, Themes: psychological</span></span>
<span id="cb27-575"><a href="#cb27-575" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Paper ID: p2_02, Themes: psychological</span></span>
<span id="cb27-576"><a href="#cb27-576" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Paper ID: p2_03, Themes: psychological</span></span>
<span id="cb27-577"><a href="#cb27-577" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Paper ID: p2_04, Themes: psychological</span></span>
<span id="cb27-578"><a href="#cb27-578" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Paper ID: p2_05, Themes: psychological</span></span>
<span id="cb27-579"><a href="#cb27-579" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Paper ID: p2_06, Themes: perceptive</span></span>
<span id="cb27-580"><a href="#cb27-580" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Paper ID: p2_07, Themes: personal</span></span>
<span id="cb27-581"><a href="#cb27-581" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Paper ID: p2_08, Themes: personal</span></span>
<span id="cb27-582"><a href="#cb27-582" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Paper ID: p2_09, Themes: perceptive</span></span>
<span id="cb27-583"><a href="#cb27-583" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Paper ID: p2_10, Themes: psychological</span></span>
<span id="cb27-584"><a href="#cb27-584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-585"><a href="#cb27-585" aria-hidden="true" tabindex="-1"></a>Since Topic Modeling is Multimembership, papers can have more than just 1 theme.</span>
<span id="cb27-586"><a href="#cb27-586" aria-hidden="true" tabindex="-1"></a>Since I didn't use a word embedding and may not get the best representatitve theme here, I decided to allow for up to 3 themes. </span>
<span id="cb27-587"><a href="#cb27-587" aria-hidden="true" tabindex="-1"></a>To do this, I changed the <span class="in">`CustomTfidfVectorizer`</span> class. </span>
<span id="cb27-588"><a href="#cb27-588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-589"><a href="#cb27-589" aria-hidden="true" tabindex="-1"></a><span class="fu">### ALLOWING FOR MULTIPLE THEMES</span></span>
<span id="cb27-590"><a href="#cb27-590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-591"><a href="#cb27-591" aria-hidden="true" tabindex="-1"></a><span class="in">```{python chunk_theme_23}</span></span>
<span id="cb27-592"><a href="#cb27-592" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> CustomTfidfVectorizerUpdateClass(TfidfVectorizer):</span>
<span id="cb27-593"><a href="#cb27-593" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, theme_keywords, threshold<span class="op">=</span><span class="fl">0.8</span>, <span class="op">**</span>kwargs):</span>
<span id="cb27-594"><a href="#cb27-594" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Generate vocabulary from theme_keywords</span></span>
<span id="cb27-595"><a href="#cb27-595" aria-hidden="true" tabindex="-1"></a>        vocabulary <span class="op">=</span> <span class="bu">list</span>(<span class="bu">set</span>(word <span class="cf">for</span> words <span class="kw">in</span> theme_keywords.values() <span class="cf">for</span> word <span class="kw">in</span> words))</span>
<span id="cb27-596"><a href="#cb27-596" aria-hidden="true" tabindex="-1"></a>        <span class="bu">super</span>().<span class="fu">__init__</span>(vocabulary<span class="op">=</span>vocabulary, <span class="op">**</span>kwargs)</span>
<span id="cb27-597"><a href="#cb27-597" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.threshold <span class="op">=</span> threshold  <span class="co"># Threshold for determining multiple themes</span></span>
<span id="cb27-598"><a href="#cb27-598" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.theme_keywords <span class="op">=</span> theme_keywords  <span class="co"># Store theme_keywords for later use</span></span>
<span id="cb27-599"><a href="#cb27-599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-600"><a href="#cb27-600" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> build_analyzer(<span class="va">self</span>):</span>
<span id="cb27-601"><a href="#cb27-601" aria-hidden="true" tabindex="-1"></a>        analyzer <span class="op">=</span> <span class="bu">super</span>().build_analyzer()</span>
<span id="cb27-602"><a href="#cb27-602" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="kw">lambda</span> doc: [w <span class="cf">for</span> w <span class="kw">in</span> analyzer(doc)]</span>
<span id="cb27-603"><a href="#cb27-603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-604"><a href="#cb27-604" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> fit(<span class="va">self</span>, raw_documents, y<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb27-605"><a href="#cb27-605" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.fit_transform(raw_documents, y)</span>
<span id="cb27-606"><a href="#cb27-606" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span></span>
<span id="cb27-607"><a href="#cb27-607" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-608"><a href="#cb27-608" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> fit_transform(<span class="va">self</span>, raw_documents, y<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb27-609"><a href="#cb27-609" aria-hidden="true" tabindex="-1"></a>        X <span class="op">=</span> <span class="bu">super</span>().fit_transform(raw_documents, y)</span>
<span id="cb27-610"><a href="#cb27-610" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.max_frequencies <span class="op">=</span> <span class="va">self</span>._compute_max_frequencies(X, raw_documents)</span>
<span id="cb27-611"><a href="#cb27-611" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> X</span>
<span id="cb27-612"><a href="#cb27-612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-613"><a href="#cb27-613" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> transform(<span class="va">self</span>, raw_documents):</span>
<span id="cb27-614"><a href="#cb27-614" aria-hidden="true" tabindex="-1"></a>        X <span class="op">=</span> <span class="bu">super</span>().transform(raw_documents)</span>
<span id="cb27-615"><a href="#cb27-615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-616"><a href="#cb27-616" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate augmented term frequency</span></span>
<span id="cb27-617"><a href="#cb27-617" aria-hidden="true" tabindex="-1"></a>        max_frequencies <span class="op">=</span> <span class="va">self</span>.max_frequencies</span>
<span id="cb27-618"><a href="#cb27-618" aria-hidden="true" tabindex="-1"></a>        max_frequencies[max_frequencies <span class="op">==</span> <span class="dv">0</span>] <span class="op">=</span> <span class="dv">1</span>  <span class="co"># Avoid division by zero</span></span>
<span id="cb27-619"><a href="#cb27-619" aria-hidden="true" tabindex="-1"></a>        augmented_tf <span class="op">=</span> <span class="fl">0.5</span> <span class="op">+</span> <span class="fl">0.5</span> <span class="op">*</span> (X.toarray() <span class="op">/</span> max_frequencies[:, <span class="va">None</span>])</span>
<span id="cb27-620"><a href="#cb27-620" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb27-621"><a href="#cb27-621" aria-hidden="true" tabindex="-1"></a>        augmented_tfidf <span class="op">=</span> augmented_tf  <span class="co"># No penalized IDF applied here</span></span>
<span id="cb27-622"><a href="#cb27-622" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-623"><a href="#cb27-623" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> csr_matrix(augmented_tfidf)</span>
<span id="cb27-624"><a href="#cb27-624" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-625"><a href="#cb27-625" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> determine_themes(<span class="va">self</span>, documents_dict):</span>
<span id="cb27-626"><a href="#cb27-626" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb27-627"><a href="#cb27-627" aria-hidden="true" tabindex="-1"></a><span class="co">        Determines the themes for each document based on TF-IDF scores.</span></span>
<span id="cb27-628"><a href="#cb27-628" aria-hidden="true" tabindex="-1"></a><span class="co">        A paper can have multiple themes if the scores are within the threshold.</span></span>
<span id="cb27-629"><a href="#cb27-629" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-630"><a href="#cb27-630" aria-hidden="true" tabindex="-1"></a><span class="co">        :param documents_dict: Dictionary of documents (keys: IDs, values: text)</span></span>
<span id="cb27-631"><a href="#cb27-631" aria-hidden="true" tabindex="-1"></a><span class="co">        :return: Dictionary where keys are document IDs and values are lists of themes</span></span>
<span id="cb27-632"><a href="#cb27-632" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb27-633"><a href="#cb27-633" aria-hidden="true" tabindex="-1"></a>        document_ids <span class="op">=</span> <span class="bu">list</span>(documents_dict.keys())</span>
<span id="cb27-634"><a href="#cb27-634" aria-hidden="true" tabindex="-1"></a>        raw_documents <span class="op">=</span> <span class="bu">list</span>(documents_dict.values())</span>
<span id="cb27-635"><a href="#cb27-635" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb27-636"><a href="#cb27-636" aria-hidden="true" tabindex="-1"></a>        X <span class="op">=</span> <span class="va">self</span>.transform(raw_documents).toarray()</span>
<span id="cb27-637"><a href="#cb27-637" aria-hidden="true" tabindex="-1"></a>        feature_name_to_index <span class="op">=</span> {name: i <span class="cf">for</span> i, name <span class="kw">in</span> <span class="bu">enumerate</span>(<span class="va">self</span>.get_feature_names_out())}</span>
<span id="cb27-638"><a href="#cb27-638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-639"><a href="#cb27-639" aria-hidden="true" tabindex="-1"></a>        theme_scores <span class="op">=</span> {}</span>
<span id="cb27-640"><a href="#cb27-640" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> doc_index, doc_vector <span class="kw">in</span> <span class="bu">enumerate</span>(X):</span>
<span id="cb27-641"><a href="#cb27-641" aria-hidden="true" tabindex="-1"></a>            doc_id <span class="op">=</span> document_ids[doc_index]</span>
<span id="cb27-642"><a href="#cb27-642" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Calculate scores for each theme</span></span>
<span id="cb27-643"><a href="#cb27-643" aria-hidden="true" tabindex="-1"></a>            scores <span class="op">=</span> {</span>
<span id="cb27-644"><a href="#cb27-644" aria-hidden="true" tabindex="-1"></a>                theme: <span class="bu">sum</span>(doc_vector[feature_name_to_index[word]]</span>
<span id="cb27-645"><a href="#cb27-645" aria-hidden="true" tabindex="-1"></a>                           <span class="cf">for</span> word <span class="kw">in</span> keywords <span class="cf">if</span> word <span class="kw">in</span> feature_name_to_index)</span>
<span id="cb27-646"><a href="#cb27-646" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> theme, keywords <span class="kw">in</span> <span class="va">self</span>.theme_keywords.items()</span>
<span id="cb27-647"><a href="#cb27-647" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb27-648"><a href="#cb27-648" aria-hidden="true" tabindex="-1"></a>            max_score <span class="op">=</span> <span class="bu">max</span>(scores.values()) <span class="cf">if</span> scores <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb27-649"><a href="#cb27-649" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb27-650"><a href="#cb27-650" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Determine themes within the threshold</span></span>
<span id="cb27-651"><a href="#cb27-651" aria-hidden="true" tabindex="-1"></a>            selected_themes <span class="op">=</span> [</span>
<span id="cb27-652"><a href="#cb27-652" aria-hidden="true" tabindex="-1"></a>                theme <span class="cf">for</span> theme, score <span class="kw">in</span> scores.items()</span>
<span id="cb27-653"><a href="#cb27-653" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> score <span class="op">&gt;=</span> <span class="va">self</span>.threshold <span class="op">*</span> max_score</span>
<span id="cb27-654"><a href="#cb27-654" aria-hidden="true" tabindex="-1"></a>            ]</span>
<span id="cb27-655"><a href="#cb27-655" aria-hidden="true" tabindex="-1"></a>            theme_scores[doc_id] <span class="op">=</span> selected_themes</span>
<span id="cb27-656"><a href="#cb27-656" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-657"><a href="#cb27-657" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> theme_scores</span>
<span id="cb27-658"><a href="#cb27-658" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-659"><a href="#cb27-659" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _compute_max_frequencies(<span class="va">self</span>, X, raw_documents):</span>
<span id="cb27-660"><a href="#cb27-660" aria-hidden="true" tabindex="-1"></a>        max_frequencies <span class="op">=</span> np.zeros(X.shape[<span class="dv">0</span>])</span>
<span id="cb27-661"><a href="#cb27-661" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i, doc <span class="kw">in</span> <span class="bu">enumerate</span>(raw_documents):</span>
<span id="cb27-662"><a href="#cb27-662" aria-hidden="true" tabindex="-1"></a>            term_freq <span class="op">=</span> {}</span>
<span id="cb27-663"><a href="#cb27-663" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> term <span class="kw">in</span> doc.split():</span>
<span id="cb27-664"><a href="#cb27-664" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> term <span class="kw">in</span> term_freq:</span>
<span id="cb27-665"><a href="#cb27-665" aria-hidden="true" tabindex="-1"></a>                    term_freq[term] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb27-666"><a href="#cb27-666" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb27-667"><a href="#cb27-667" aria-hidden="true" tabindex="-1"></a>                    term_freq[term] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb27-668"><a href="#cb27-668" aria-hidden="true" tabindex="-1"></a>            max_frequencies[i] <span class="op">=</span> <span class="bu">max</span>(term_freq.values())</span>
<span id="cb27-669"><a href="#cb27-669" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> max_frequencies</span>
<span id="cb27-670"><a href="#cb27-670" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-671"><a href="#cb27-671" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-672"><a href="#cb27-672" aria-hidden="true" tabindex="-1"></a>Similar to the above task, I generate the vectorizer from <span class="in">`theme_of_words_cleaned`</span> vocabulary, but this time, allow for a few more themes (<span class="in">`threshold = 0.75`</span>). </span>
<span id="cb27-673"><a href="#cb27-673" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-674"><a href="#cb27-674" aria-hidden="true" tabindex="-1"></a><span class="in">```{python chunk_theme_24}</span></span>
<span id="cb27-675"><a href="#cb27-675" aria-hidden="true" tabindex="-1"></a>vectorizer_keys2 <span class="op">=</span> CustomTfidfVectorizerUpdateClass(theme_keywords <span class="op">=</span> theme_of_words_cleaned, threshold <span class="op">=</span> <span class="fl">0.75</span>) </span>
<span id="cb27-676"><a href="#cb27-676" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-677"><a href="#cb27-677" aria-hidden="true" tabindex="-1"></a>tfidf_matrix2 <span class="op">=</span> vectorizer_keys2.fit_transform(papers_cleaned.values())</span>
<span id="cb27-678"><a href="#cb27-678" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-679"><a href="#cb27-679" aria-hidden="true" tabindex="-1"></a>tfidf_df2 <span class="op">=</span> pd.DataFrame(tfidf_matrix2.toarray(), index<span class="op">=</span>papers_cleaned.keys(), columns<span class="op">=</span>vectorizer_keys2.get_feature_names_out())</span>
<span id="cb27-680"><a href="#cb27-680" aria-hidden="true" tabindex="-1"></a>tfidf_df2.head()</span>
<span id="cb27-681"><a href="#cb27-681" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-682"><a href="#cb27-682" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-683"><a href="#cb27-683" aria-hidden="true" tabindex="-1"></a><span class="al">![](/images/tfidf_2.png)</span></span>
<span id="cb27-684"><a href="#cb27-684" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-685"><a href="#cb27-685" aria-hidden="true" tabindex="-1"></a>You can still pick a main theme for each paper, but I want to see the top 3 themes: </span>
<span id="cb27-686"><a href="#cb27-686" aria-hidden="true" tabindex="-1"></a><span class="in">```{python chunk_theme_25}</span></span>
<span id="cb27-687"><a href="#cb27-687" aria-hidden="true" tabindex="-1"></a>keyword_to_theme2 <span class="op">=</span> {keyword: theme <span class="cf">for</span> theme, keywords <span class="kw">in</span> theme_of_words_cleaned.items() <span class="cf">for</span> keyword <span class="kw">in</span> keywords}</span>
<span id="cb27-688"><a href="#cb27-688" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-689"><a href="#cb27-689" aria-hidden="true" tabindex="-1"></a>theme_weights2 <span class="op">=</span> pd.DataFrame(<span class="dv">0</span>, index<span class="op">=</span>tfidf_df2.index, columns<span class="op">=</span>theme_of_words_cleaned.keys())</span>
<span id="cb27-690"><a href="#cb27-690" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-691"><a href="#cb27-691" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> keyword, theme <span class="kw">in</span> keyword_to_theme2.items():</span>
<span id="cb27-692"><a href="#cb27-692" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> keyword <span class="kw">in</span> tfidf_df2.columns:</span>
<span id="cb27-693"><a href="#cb27-693" aria-hidden="true" tabindex="-1"></a>        theme_weights2[theme] <span class="op">+=</span> tfidf_df2[keyword]</span>
<span id="cb27-694"><a href="#cb27-694" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-695"><a href="#cb27-695" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> _, row <span class="kw">in</span> df2.iterrows():</span>
<span id="cb27-696"><a href="#cb27-696" aria-hidden="true" tabindex="-1"></a>    paper_id <span class="op">=</span> row[<span class="st">'ID'</span>]</span>
<span id="cb27-697"><a href="#cb27-697" aria-hidden="true" tabindex="-1"></a>    <span class="co">#for keyword in words_acrossAll_nonGeneric:</span></span>
<span id="cb27-698"><a href="#cb27-698" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> keyword <span class="kw">in</span> vectorizer_keys2.get_feature_names_out():</span>
<span id="cb27-699"><a href="#cb27-699" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> keyword <span class="kw">in</span> tfidf_df2.columns:</span>
<span id="cb27-700"><a href="#cb27-700" aria-hidden="true" tabindex="-1"></a>            theme <span class="op">=</span> keyword_to_theme2.get(keyword, <span class="va">None</span>)</span>
<span id="cb27-701"><a href="#cb27-701" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> theme:</span>
<span id="cb27-702"><a href="#cb27-702" aria-hidden="true" tabindex="-1"></a>                <span class="co"># the 5 I'm adding here is just to make the weights a bit larger for visualization. It's a simple scaling and won't change the results </span></span>
<span id="cb27-703"><a href="#cb27-703" aria-hidden="true" tabindex="-1"></a>                theme_weights2.at[paper_id, theme] <span class="op">+=</span> tfidf_df2.at[paper_id, keyword] <span class="op">*</span> <span class="dv">5</span></span>
<span id="cb27-704"><a href="#cb27-704" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-705"><a href="#cb27-705" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-706"><a href="#cb27-706" aria-hidden="true" tabindex="-1"></a>top_3_themes_for_papers <span class="op">=</span> {</span>
<span id="cb27-707"><a href="#cb27-707" aria-hidden="true" tabindex="-1"></a>    paper_id: theme_weights2.loc[paper_id]</span>
<span id="cb27-708"><a href="#cb27-708" aria-hidden="true" tabindex="-1"></a>    .sort_values(ascending<span class="op">=</span><span class="va">False</span>)[:<span class="dv">3</span>]  </span>
<span id="cb27-709"><a href="#cb27-709" aria-hidden="true" tabindex="-1"></a>    .index.tolist()</span>
<span id="cb27-710"><a href="#cb27-710" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> paper_id <span class="kw">in</span> theme_weights2.index</span>
<span id="cb27-711"><a href="#cb27-711" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-712"><a href="#cb27-712" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-713"><a href="#cb27-713" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> paper_id, themes <span class="kw">in</span> top_3_themes_for_papers.items():</span>
<span id="cb27-714"><a href="#cb27-714" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Paper ID: </span><span class="sc">{</span>paper_id<span class="sc">}</span><span class="ss">, Top 3 Themes: </span><span class="sc">{</span><span class="st">', '</span><span class="sc">.</span>join(themes)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb27-715"><a href="#cb27-715" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-716"><a href="#cb27-716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-717"><a href="#cb27-717" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb27-718"><a href="#cb27-718" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-719"><a href="#cb27-719" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Paper ID: p2_01, Top 3 Themes: psychological, cultural, demographic</span></span>
<span id="cb27-720"><a href="#cb27-720" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Paper ID: p2_02, Top 3 Themes: psychological, market, personal</span></span>
<span id="cb27-721"><a href="#cb27-721" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Paper ID: p2_03, Top 3 Themes: psychological, personal, perceptive</span></span>
<span id="cb27-722"><a href="#cb27-722" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Paper ID: p2_04, Top 3 Themes: psychological, personal, perceptive</span></span>
<span id="cb27-723"><a href="#cb27-723" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Paper ID: p2_05, Top 3 Themes: cultural, personal, psychological</span></span>
<span id="cb27-724"><a href="#cb27-724" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Paper ID: p2_06, Top 3 Themes: perceptive, cultural, psychological</span></span>
<span id="cb27-725"><a href="#cb27-725" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Paper ID: p2_07, Top 3 Themes: personal, psychological, demographic</span></span>
<span id="cb27-726"><a href="#cb27-726" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Paper ID: p2_08, Top 3 Themes: psychological, personal, perceptive</span></span>
<span id="cb27-727"><a href="#cb27-727" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Paper ID: p2_09, Top 3 Themes: perceptive, psychological, personal</span></span>
<span id="cb27-728"><a href="#cb27-728" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Paper ID: p2_10, Top 3 Themes: psychological, cultural, personal</span></span>
<span id="cb27-729"><a href="#cb27-729" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-730"><a href="#cb27-730" aria-hidden="true" tabindex="-1"></a>Keep a copy and save this to file: </span>
<span id="cb27-731"><a href="#cb27-731" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-732"><a href="#cb27-732" aria-hidden="true" tabindex="-1"></a><span class="in">```{python chunk_theme_26}</span></span>
<span id="cb27-733"><a href="#cb27-733" aria-hidden="true" tabindex="-1"></a>df3 <span class="op">=</span> df2.copy()</span>
<span id="cb27-734"><a href="#cb27-734" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-735"><a href="#cb27-735" aria-hidden="true" tabindex="-1"></a>top_3_themes_for_papers <span class="op">=</span> {</span>
<span id="cb27-736"><a href="#cb27-736" aria-hidden="true" tabindex="-1"></a>    paper_id: <span class="st">", "</span>.join(theme_weights2.loc[paper_id]</span>
<span id="cb27-737"><a href="#cb27-737" aria-hidden="true" tabindex="-1"></a>                         .sort_values(ascending<span class="op">=</span><span class="va">False</span>)[:<span class="dv">3</span>]</span>
<span id="cb27-738"><a href="#cb27-738" aria-hidden="true" tabindex="-1"></a>                         .index.tolist())</span>
<span id="cb27-739"><a href="#cb27-739" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> paper_id <span class="kw">in</span> theme_weights2.index</span>
<span id="cb27-740"><a href="#cb27-740" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-741"><a href="#cb27-741" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-742"><a href="#cb27-742" aria-hidden="true" tabindex="-1"></a>df3[<span class="st">"Algo_Theme"</span>] <span class="op">=</span> df2[<span class="st">"ID"</span>].<span class="bu">map</span>(top_3_themes_for_papers)</span>
<span id="cb27-743"><a href="#cb27-743" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-744"><a href="#cb27-744" aria-hidden="true" tabindex="-1"></a>df3.to_csv(<span class="st">"NewWithThemes.csv"</span>)</span>
<span id="cb27-745"><a href="#cb27-745" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>